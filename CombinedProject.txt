--- Содержимое Agrovent ---
==============================================================

--- Файл: AgroventAddin.cs ---
==============================================================
using System.ComponentModel.Design;
using System.Runtime.InteropServices;
using System.Text;
using Agrovent.DAL;
using Agrovent.DAL.Entities.Components;
using Agrovent.Infrastructure.Interfaces;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.Services;
using Agrovent.ViewModels.Components;
using Agrovent.ViewModels.Specification;
using Agrovent.ViewModels.TaskPane;
using Agrovent.Views.Windows;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using Xarial.XCad.SolidWorks;
using Xarial.XCad.SolidWorks.Documents;
using Xarial.XCad.UI.Commands;

namespace Agrovent
{
    [ComVisible(true)]
    [Guid("8864d08d-f77a-47b9-858f-4af5eea4fd76")]
    public class AgroventAddin : SwAddInEx
    {
        #region DI Services
        private ILogger<AgroventAddin> _logger;
        private IAGR_ComponentVersionService _versionService;
        private DataContext _dbContext;
        #endregion

        public override void OnConnect()
        {
            try
            {
                // ������������� ���������� ��������
                InitDI();

                // ��������� �������� �� ����������
                _logger = AGR_ServiceContainer.GetService<ILogger<AgroventAddin>>();
                _versionService = AGR_ServiceContainer.GetService<IAGR_ComponentVersionService>();
                _dbContext = AGR_ServiceContainer.GetService<DataContext>();

                // �������� � �������� �� (���� �����)
                EnsureDatabaseCreated();

                // ������� �������� � Behaviour
                Encoding.RegisterProvider(CodePagesEncodingProvider.Instance);

                // ������������� ������ ������ � SolidWorks
                CommandManager.AddCommandGroup<AGR_Commands_e>().CommandClick += OnCommandClickExecute;

                // ������������� ������ ������������� TaskPane
                InitTaskPane();

                _logger.LogInformation("AddIn ������� ��������.");
            }
            catch (Exception ex)
            {
                Application.ShowMessageBox($"������ ��� �������� AddIn: {ex.Message}",
                    Xarial.XCad.Base.Enums.MessageBoxIcon_e.Error);
                throw;
            }
        }

        private void EnsureDatabaseCreated()
        {
            try
            {
                _logger.LogInformation("�������� ���� ������...");
                _dbContext.Database.EnsureCreated();
                _logger.LogInformation("���� ������ ������ � ������.");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "������ ��� ������������� ���� ������");
                Application.ShowMessageBox($"������ ����������� � ���� ������: {ex.Message}",
                    Xarial.XCad.Base.Enums.MessageBoxIcon_e.Warning);
            }
        }

        public override void OnDisconnect()
        {
            try
            {
                _dbContext?.Dispose();
                _logger?.LogInformation("AddIn ������� ��������.");
            }
            catch (Exception ex)
            {
                _logger?.LogError(ex, "������ ��� ���������� AddIn");
            }
        }

        private void OnCommandClickExecute(AGR_Commands_e command)
        {
            try
            {
                switch (command)
                {
                    case AGR_Commands_e.Command1:
                        ShowSpecificationWindow();
                        break;

                    case AGR_Commands_e.Command2:
                        ShowAvaArticleInfo();
                        break;

                    case AGR_Commands_e.SaveComponent:
                        SaveActiveComponent();
                        break;

                    case AGR_Commands_e.SaveAssembly:
                        SaveActiveAssembly();
                        break;

                    default:
                        break;
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "������ ��� ���������� �������");
                Application.ShowMessageBox($"������: {ex.Message}",
                    Xarial.XCad.Base.Enums.MessageBoxIcon_e.Error);
            }
        }

        private void ShowSpecificationWindow()
        {
            if (Application.Documents.Active is ISwAssembly swAssembly)
            {
                var assemblyVM = new AGR_AssemblyComponentVM(swAssembly);
                var specWindow = new AGR_SpecificationWindow();
                specWindow.DataContext = new AGR_SpecificationViewModel(assemblyVM);
                specWindow.ShowDialog();
            }
            else
            {
                Application.ShowMessageBox("�������� ������ ��� ��������� ������������",
                    Xarial.XCad.Base.Enums.MessageBoxIcon_e.Info);
            }
        }

        private void ShowAvaArticleInfo()
        {
            try
            {
                using var scope = AGR_ServiceContainer.CreateScope();
                var dbContext = scope.ServiceProvider.GetRequiredService<DataContext>();
                var article = dbContext.Set<AvaArticleModel>().FirstOrDefault();

                if (article != null)
                {
                    Application.ShowMessageBox($"���:{article.Name}\n�������:{article.Article}\n���:{article.Type}\n���:{article.PartNumber}\n�����:{article.Brand}",
                        Xarial.XCad.Base.Enums.MessageBoxIcon_e.Info,
                        Xarial.XCad.Base.Enums.MessageBoxButtons_e.Ok);
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "������ ��� ��������� ���������� � ������");
            }
        }

        private async void SaveActiveComponent()
        {
            try
            {
                if (Application.Documents.Active is ISwDocument3D swDoc)
                {
                    _logger.LogInformation($"���������� ����������: {swDoc.Title}");

                    IAGR_BaseComponent component = swDoc switch
                    {
                        ISwPart part => new AGR_PartComponentVM(part),
                        ISwAssembly assembly => new AGR_AssemblyComponentVM(assembly),
                        _ => throw new InvalidOperationException("���������������� ��� ���������")
                    };

                    var saved = await _versionService.CheckAndSaveComponentAsync(component);

                    if (saved)
                    {
                        Application.ShowMessageBox($"��������� {component.Name} ������� �������� � ���� ������",
                            Xarial.XCad.Base.Enums.MessageBoxIcon_e.Info);
                    }
                    else
                    {
                        Application.ShowMessageBox($"��������� {component.Name} �� ��������� ��� ��� ���������� � ���� ������",
                            Xarial.XCad.Base.Enums.MessageBoxIcon_e.Info);
                    }
                }
                else
                {
                    Application.ShowMessageBox("�������� 3D-�������� ��� ����������",
                        Xarial.XCad.Base.Enums.MessageBoxIcon_e.Warning);
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "������ ��� ���������� ����������");
                Application.ShowMessageBox($"������ ����������: {ex.Message}",
                    Xarial.XCad.Base.Enums.MessageBoxIcon_e.Error);
            }
        }

        private async void SaveActiveAssembly()
        {
            try
            {
                if (Application.Documents.Active is ISwAssembly swAssembly)
                {
                    _logger.LogInformation($"���������� ������: {swAssembly.Title}");

                    var assembly = new AGR_AssemblyComponentVM(swAssembly);
                    var saved = await _versionService.CheckAndSaveAssemblyAsync(assembly);

                    if (saved)
                    {
                        Application.ShowMessageBox($"������ {assembly.Name} ������� ��������� � ���� ������",
                            Xarial.XCad.Base.Enums.MessageBoxIcon_e.Info);
                    }
                    else
                    {
                        Application.ShowMessageBox($"������ {assembly.Name} �� ���������� ��� ��� ���������� � ���� ������",
                            Xarial.XCad.Base.Enums.MessageBoxIcon_e.Info);
                    }
                }
                else
                {
                    Application.ShowMessageBox("�������� ������ ��� ����������",
                        Xarial.XCad.Base.Enums.MessageBoxIcon_e.Warning);
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "������ ��� ���������� ������");
                Application.ShowMessageBox($"������ ����������: {ex.Message}",
                    Xarial.XCad.Base.Enums.MessageBoxIcon_e.Error);
            }
        }

        private void InitDI()
        {
            AGR_ServiceContainer.Initialize(services =>
            {
                // ����������� ������ AddIn
                services.AddSingleton<AgroventAddin>(this);

                // �������������� �������, ����������� ��� SolidWorks
                services.AddSingleton(Application);
                services.AddSingleton(CommandManager);

                // ViewModels
                services.AddTransient<AGR_TaskPaneViewModel>();
            });
        }

        private void InitTaskPane()
        {
            try
            {
                var taskPaneVM = AGR_ServiceContainer.GetService<AGR_TaskPaneViewModel>();
                var taskPaneView = this.CreateTaskPaneWpf<AGR_TaskPaneView>();
                taskPaneView.Control.DataContext = taskPaneVM;
                taskPaneView.IsActive = true;
                taskPaneView.Control.Focus();

                _logger.LogInformation("TaskPane ���������������");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "������ ��� ������������� TaskPane");
            }
        }
    }

    public enum AGR_Commands_e
    {
        Command1,     // �������� ������������
        Command2,     // �������� ���������� � ������
        SaveComponent, // ��������� ������
        SaveAssembly   // ��������� ������
    }
}

#region MyRegion

//using System.ComponentModel.Design;
//using System.Runtime.InteropServices;
//using System.Text;
//using Agrovent.DAL;
//using Agrovent.Services;
//using Agrovent.ViewModels.Components;
//using Agrovent.ViewModels.Specification;
//using Agrovent.ViewModels.TaskPane;
//using Agrovent.Views.Windows;
//using Microsoft.Extensions.DependencyInjection;
//using Microsoft.Extensions.Logging;
//using Xarial.XCad.SolidWorks;
//using Xarial.XCad.SolidWorks.Documents;
//using Xarial.XCad.UI.Commands;

//namespace Agrovent
//{
//    [ComVisible(true)]
//    [Guid("8864d08d-f77a-47b9-858f-4af5eea4fd76")]
//    public class AgroventAddin : SwAddInEx
//    {
//        #region DI Services
//        private ILogger<AgroventAddin> _logger;
//        #endregion

//        public override void OnConnect()
//        {
//            //������������� ���������� ��������
//            InitDI();

//            //��������� �������� �� ����������
//            _logger = AGR_ServiceContainer.GetService<ILogger<AgroventAddin>>();

//            //������� �������� � Behaviour
//            Encoding.RegisterProvider(CodePagesEncodingProvider.Instance);

//            //������������� ������ ������ � ������
//            CommandManager.AddCommandGroup<AGR_Commands_e>().CommandClick += OnCommandClickExecute;

//            //������������� ������ ������������� TaskPane
//            InitTaskPane();

//            _logger.LogDebug("AddIn ������� ���������.");

//        }



//        public override void OnDisconnect()
//        {
//            // Cleanup code here
//        }

//        private void OnCommandClickExecute(AGR_Commands_e command)
//        {
//            switch (command)
//            {
//                case AGR_Commands_e.Command1:

//                    if (Application.Documents.Active is ISwAssembly swAssembly)
//                    {
//                        AGR_SpecificationWindow specWindow = new AGR_SpecificationWindow();
//                        specWindow.DataContext = new AGR_SpecificationViewModel(new AGR_AssemblyComponentVM(swAssembly));
//                        specWindow.ShowDialog();
//                    }

//                    break;
//                case AGR_Commands_e.Command2:
//                    // Handle Command2
//                    DataContext dataContext = new DataContext();
//                    var a = dataContext.AvaArticles.First();
//                    Application.ShowMessageBox($"���:{a.Name}\n�������:{a.Article}\n���:{a.Type}\n���:{a.PartNumber}\n�����:{a.Brand}",
//                        Xarial.XCad.Base.Enums.MessageBoxIcon_e.Info,
//                        Xarial.XCad.Base.Enums.MessageBoxButtons_e.Ok);
//                    break;

//                default:
//                    break;
//            }
//        }
//        private void InitDI()
//        {
//            AGR_ServiceContainer.Initialize(services =>
//            {
//                // �������������� ����������� ����������� ��� ������ Add-in
//                services.AddSingleton<AgroventAddin>(this);

//                // ����� �������� ������������ �� �����
//                // services.AddSingleton<IConfiguration>(LoadConfiguration());
//            });
//        }
//        private void InitTaskPane()
//        {
//            var _taskPaneVM = AGR_ServiceContainer.GetService<AGR_TaskPaneViewModel>();
//            var taskPaneView = this.CreateTaskPaneWpf<AGR_TaskPaneView>();
//            //taskPaneView.Control.DataContext = _taskPaneVM;
//            taskPaneView.IsActive = true;
//            taskPaneView.Control.Focus();
//        }
//    }


//    public enum AGR_Commands_e
//    {
//        Command1,
//        Command2
//    }

//}

#endregion



--- Файл: DataContext.cs ---
==============================================================
using Microsoft.EntityFrameworkCore;
using Agrovent.DAL.Entities;
using Agrovent.DAL.Entities.Components;
using Microsoft.Extensions.Configuration;
using Agrovent.Infrastructure.Interfaces;

namespace Agrovent.DAL
{
    public class DataContext : DbContext
    {
        private readonly IConfiguration _configuration;
        
        #region DataSet
        public DbSet<Component> Components { get; set; }
        public DbSet<ComponentVersion> ComponentVersions { get; set; }
        public DbSet<ComponentProperty> ComponentProperties { get; set; }
        public DbSet<ComponentMaterial> ComponentMaterials { get; set; }
        public DbSet<AssemblyStructure> AssemblyStructures { get; set; }
        public DbSet<ComponentFile> ComponentFiles { get; set; }
        public DbSet<AvaArticleModel> AvaArticles { get; set; } 
        #endregion

        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        {
            if (!optionsBuilder.IsConfigured)
            {
                var connectionString = _configuration?.GetConnectionString("DefaultConnection") ?? "Host=192.168.15.200;Port=5432;Database=PRPMDB2;Username=user;Password=sauser#1;";
                optionsBuilder.UseNpgsql(connectionString);
            }
            //optionsBuilder.UseNpgsql($"Host=localhost;Database=PRPMDB;Username=user;Password=sauser#1;");
        }
        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            // Компоненты - уникальный PartNumber
            modelBuilder.Entity<Component>()
                .HasIndex(c => c.PartNumber)
                .IsUnique();

            // Версии компонентов - уникальная комбинация ComponentId + Version
            modelBuilder.Entity<ComponentVersion>()
                .HasIndex(cv => new { cv.ComponentId, cv.Version })
                .IsUnique();

            // Хеш-сумма должна быть уникальной для версии
            modelBuilder.Entity<ComponentVersion>()
                .HasIndex(cv => cv.HashSum)
                .IsUnique();

            // Связи
            modelBuilder.Entity<Component>()
                .HasMany(c => c.Versions)
                .WithOne(cv => cv.Component)
                .HasForeignKey(cv => cv.ComponentId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<ComponentVersion>()
                .HasMany(cv => cv.Properties)
                .WithOne(p => p.ComponentVersion)
                .HasForeignKey(p => p.ComponentVersionId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<ComponentVersion>()
                .HasOne(cv => cv.Material)
                .WithOne(m => m.ComponentVersion)
                .HasForeignKey<ComponentMaterial>(m => m.ComponentVersionId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<ComponentVersion>()
                .HasMany(cv => cv.Files)
                .WithOne(f => f.ComponentVersion)
                .HasForeignKey(f => f.ComponentVersionId)
                .OnDelete(DeleteBehavior.Cascade);

            // Структура сборки - самореференциальная связь
            modelBuilder.Entity<AssemblyStructure>(entity =>
            {
                // Связь с версией сборки
                entity.HasOne(a => a.AssemblyVersion)
                    .WithMany()
                    .HasForeignKey(a => a.AssemblyVersionId)
                    .OnDelete(DeleteBehavior.Cascade);

                // Связь с версией компонента
                entity.HasOne(a => a.ComponentVersion)
                    .WithMany()
                    .HasForeignKey(a => a.ComponentVersionId)
                    .OnDelete(DeleteBehavior.Cascade);

                // Связь с родительской структурой
                entity.HasOne(a => a.ParentStructure)
                    .WithMany(a => a.ChildStructures)
                    .HasForeignKey(a => a.ParentStructureId)
                    .OnDelete(DeleteBehavior.Restrict); // Изменяем на Restrict или SetNull

                // Индексы
                entity.HasIndex(a => a.AssemblyVersionId);
                entity.HasIndex(a => a.ComponentVersionId);
                entity.HasIndex(a => a.ParentStructureId);
            });

            // Индекс для быстрого поиска структуры по сборке
            modelBuilder.Entity<AssemblyStructure>()
                .HasIndex(a => a.AssemblyVersionId);

            // Индекс для быстрого поиска где используется компонент
            modelBuilder.Entity<AssemblyStructure>()
                .HasIndex(a => a.ComponentVersionId);

            modelBuilder.Entity<AvaArticleModel>()
                .HasKey(a => a.Article);
        }


        public DataContext()
        {
                
        }

        public DataContext(IConfiguration configuration)
        {
            _configuration = configuration;
        }
    }
}




--- Файл: AGR_Options.cs ---
==============================================================
namespace Agrovent.Infrastructure
{
    public static class AGR_Options
    {
        public const string StorageRootFolderPath = @"\\192.168.10.1\kd\!StorageRootFolder";
        public const string ProductionRootFolderPath = @"\\192.168.10.1\kd\Listogib\!TestRootFolder";
    }
}




--- Файл: AGR_ComponentViewModelCache.cs ---
==============================================================
// AGR_ComponentViewModelCache.cs
using System.Collections.Concurrent;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.Infrastructure.Interfaces.Services;
using Agrovent.ViewModels.Components;
using Xarial.XCad.Documents;
using Xarial.XCad.SolidWorks.Documents;
using System.IO;
using Microsoft.Extensions.Logging;

namespace Agrovent.Services
{
    public class AGR_ComponentViewModelCache : IAGR_ComponentViewModelCache
    {
        private readonly ConcurrentDictionary<string, WeakReference<IAGR_BaseComponent>> _viewModelCache;
        private readonly ILogger<AGR_ComponentViewModelCache> _logger;
        private readonly SemaphoreSlim _semaphore = new SemaphoreSlim(1, 1);

        public AGR_ComponentViewModelCache(ILogger<AGR_ComponentViewModelCache> logger)
        {
            _viewModelCache = new ConcurrentDictionary<string, WeakReference<IAGR_BaseComponent>>();
            _logger = logger;
        }

        public async Task<IAGR_BaseComponent> GetOrCreateViewModelAsync(IXDocument document)
        {
            if (document == null)
                throw new ArgumentNullException(nameof(document));

            var swDoc = document as ISwDocument3D;
            if (swDoc == null)
                throw new InvalidOperationException("Document must be a SolidWorks 3D document");

            var cacheKey = GetCacheKey(swDoc);

            try
            {
                // Пытаемся получить из кэша
                if (_viewModelCache.TryGetValue(cacheKey, out var weakRef) &&
                    weakRef.TryGetTarget(out var cachedViewModel))
                {
                    _logger.LogDebug($"ViewModel found in cache: {cacheKey}");
                    return cachedViewModel;
                }

                // Если не нашли в кэше, создаем новую
                await _semaphore.WaitAsync();
                try
                {
                    // Двойная проверка под блокировкой
                    if (_viewModelCache.TryGetValue(cacheKey, out weakRef) &&
                        weakRef.TryGetTarget(out cachedViewModel))
                    {
                        _logger.LogDebug($"ViewModel found in cache after lock: {cacheKey}");
                        return cachedViewModel;
                    }

                    _logger.LogInformation($"Creating new ViewModel for: {cacheKey}");

                    IAGR_BaseComponent viewModel = swDoc switch
                    {
                        ISwPart part => new AGR_PartComponentVM(part),
                        ISwAssembly assembly => new AGR_AssemblyComponentVM(assembly),
                        _ => throw new NotSupportedException($"Document type not supported: {swDoc.GetType()}")
                    };

                    // Добавляем в кэш с WeakReference
                    _viewModelCache[cacheKey] = new WeakReference<IAGR_BaseComponent>(viewModel);

                    // Очищаем кэш от "мертвых" ссылок
                    CleanupDeadReferences();

                    return viewModel;
                }
                finally
                {
                    _semaphore.Release();
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error getting or creating ViewModel for {cacheKey}");
                throw;
            }
        }

        public async Task<IAGR_BaseComponent> GetViewModelByPathAsync(string filePath)
        {
            if (string.IsNullOrEmpty(filePath))
                return null;

            var cacheKey = Path.GetFullPath(filePath).ToLowerInvariant();

            if (_viewModelCache.TryGetValue(cacheKey, out var weakRef) &&
                weakRef.TryGetTarget(out var viewModel))
            {
                return viewModel;
            }

            return null;
        }

        public void Clear()
        {
            _viewModelCache.Clear();
            _logger.LogInformation("ViewModel cache cleared");
        }

        public bool RemoveViewModel(string key)
        {
            return _viewModelCache.TryRemove(key, out _);
        }

        public (int Total, int Part, int Assembly) GetCacheStatistics()
        {
            int aliveCount = 0, partCount = 0, assemblyCount = 0;

            foreach (var kvp in _viewModelCache)
            {
                if (kvp.Value.TryGetTarget(out var vm))
                {
                    aliveCount++;
                    if (vm is AGR_PartComponentVM)
                        partCount++;
                    else if (vm is AGR_AssemblyComponentVM)
                        assemblyCount++;
                }
            }

            return (aliveCount, partCount, assemblyCount);
        }

        private string GetCacheKey(ISwDocument3D document)
        {
            // Используем полный путь к файлу как ключ
            // Также можно добавить хеш содержимого для учета изменений
            return Path.GetFullPath(document.Path).ToLowerInvariant();
        }

        private void CleanupDeadReferences()
        {
            // Очищаем кэш только если он стал слишком большим
            if (_viewModelCache.Count > 100)
            {
                var deadKeys = _viewModelCache
                    .Where(kvp => !kvp.Value.TryGetTarget(out _))
                    .Select(kvp => kvp.Key)
                    .ToList();

                foreach (var key in deadKeys)
                {
                    _viewModelCache.TryRemove(key, out _);
                }

                if (deadKeys.Count > 0)
                {
                    _logger.LogDebug($"Cleaned up {deadKeys.Count} dead references from cache");
                }
            }
        }
    }
}



--- Файл: AGR_ComponentViewModelFactory.cs ---
==============================================================
// ComponentViewModelFactory.cs (если нужно создавать ViewModel с зависимостями)
using Agrovent.Infrastructure.Extensions;
using Agrovent.Infrastructure.Interfaces;
using Agrovent.Infrastructure.Interfaces.Components;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.Infrastructure.Interfaces.Services;
using Agrovent.ViewModels.Components;
using Agrovent.ViewModels.Specification;
using Microsoft.Extensions.Logging;
using Xarial.XCad.SolidWorks.Documents;

namespace Agrovent.Services
{
    public interface IAGR_ComponentViewModelFactory
    {
        AGR_AssemblyComponentVM CreateAssemblyComponent(ISwDocument3D document);
        Task<AGR_AssemblyComponentVM> CreateAssemblyComponentAsync(ISwDocument3D document);
        Task<IAGR_BaseComponent> CreateComponentAsync(ISwDocument3D document);
        AGR_PartComponentVM CreatePartComponent(ISwDocument3D document);
        Task<AGR_PartComponentVM> CreatePartComponentAsync(ISwDocument3D document);
    }

    public class AGR_ComponentViewModelFactory : IAGR_ComponentViewModelFactory
    {
        private readonly IAGR_ComponentViewModelCache _cache;
        private readonly ILogger<AGR_ComponentViewModelFactory> _logger;

        public AGR_ComponentViewModelFactory(
            IAGR_ComponentViewModelCache cache,
            ILogger<AGR_ComponentViewModelFactory> logger)
        {
            _cache = cache;
            _logger = logger;
        }

        public async Task<AGR_AssemblyComponentVM> CreateAssemblyComponentAsync(ISwDocument3D document)
        {
            _logger.LogDebug($"Creating assembly component async: {document.Title}");

            try
            {
                // Используем кэш
                var viewModel = await _cache.GetOrCreateViewModelAsync(document) as AGR_AssemblyComponentVM;

                // Если это новая ViewModel, асинхронно загружаем компоненты
                if (viewModel?.AGR_TopComponents?.Count == 0)
                {
                    await Task.Run(() => LoadAssemblyComponents(viewModel, document));
                }

                return viewModel;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error creating assembly component: {document.Title}");
                throw;
            }
        }

        public async Task<AGR_PartComponentVM> CreatePartComponentAsync(ISwDocument3D document)
        {
            _logger.LogDebug($"Creating part component async: {document.Title}");

            try
            {
                // Используем кэш
                return await _cache.GetOrCreateViewModelAsync(document) as AGR_PartComponentVM;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error creating part component: {document.Title}");
                throw;
            }
        }

        public async Task<IAGR_BaseComponent> CreateComponentAsync(ISwDocument3D document)
        {
            _logger.LogDebug($"Creating component async: {document.Title}");

            return document switch
            {
                ISwPart part => await CreatePartComponentAsync(part),
                ISwAssembly assembly => await CreateAssemblyComponentAsync(assembly),
                _ => throw new NotSupportedException($"Document type not supported: {document.GetType()}")
            };
        }

        // Синхронные методы для обратной совместимости
        public AGR_AssemblyComponentVM CreateAssemblyComponent(ISwDocument3D document)
        {
            _logger.LogDebug($"Creating assembly component sync: {document.Title}");

            try
            {
                var viewModel = new AGR_AssemblyComponentVM(document as ISwAssembly);
                return viewModel;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error creating assembly component sync: {document.Title}");
                throw;
            }
        }

        public AGR_PartComponentVM CreatePartComponent(ISwDocument3D document)
        {
            _logger.LogDebug($"Creating part component sync: {document.Title}");

            try
            {
                return new AGR_PartComponentVM(document as ISwPart);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error creating part component sync: {document.Title}");
                throw;
            }
        }

        private void LoadAssemblyComponents(AGR_AssemblyComponentVM viewModel, ISwDocument3D document)
        {
            try
            {
                _logger.LogDebug($"Loading assembly components for: {document.Title}");

                var assembly = document as ISwAssembly;
                if (assembly == null) return;

                // Оптимизация: получаем компоненты только верхнего уровня
                var topComponents = assembly.Configurations.Active.Components.AGR_ActiveComponents();

                // Группируем и создаем SpecificationItemVM для верхнего уровня
                var groupedTop = topComponents
                    .GroupBy(c => new { c.ReferencedDocument?.Title, c.ReferencedConfiguration?.Name })
                    .Select(g =>
                    {
                        try
                        {
                            var firstComp = g.First();
                            if (firstComp.ReferencedDocument is ISwDocument3D swDoc)
                            {
                                // Создаем или получаем ViewModel для компонента
                                var componentViewModel = Task.Run(async () =>
                                    await CreateComponentAsync(swDoc)).Result;

                                return new AGR_SpecificationItemVM(componentViewModel, g.Count());
                            }
                            return null;
                        }
                        catch (Exception ex)
                        {
                            _logger.LogWarning(ex, "Error creating specification item");
                            return null;
                        }
                    })
                    .Where(item => item != null)
                    .ToList();

                // Обновляем коллекцию в UI потоке
                System.Windows.Application.Current.Dispatcher.Invoke(() =>
                {
                    viewModel.AGR_TopComponents = new System.Collections.ObjectModel.ObservableCollection<AGR_SpecificationItemVM>(groupedTop);
                    _logger.LogDebug($"Assembly components loaded: {groupedTop.Count} items");
                });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error loading assembly components: {document.Title}");
                throw;
            }
        }
    }
}



--- Файл: AGR_ServiceContainer.cs ---
==============================================================
// AGR_ServiceContainer.cs в основном проекте
using Microsoft.Extensions.DependencyInjection;

namespace Agrovent
{
    public static class AGR_ServiceContainer
    {
        private static IServiceProvider _serviceProvider;
        private static IServiceCollection _services;

        public static void Initialize(Action<IServiceCollection> configureServices = null)
        {
            _services = new ServiceCollection();

            // Базовая конфигурация
            _services.ConfigureServices();

            // Дополнительная конфигурация от вызывающего кода
            configureServices?.Invoke(_services);

            _serviceProvider = _services.BuildServiceProvider();
        }

        public static T GetService<T>() where T : class
        {
            if (_serviceProvider == null)
                throw new InvalidOperationException("ServiceProvider не инициализирован. Вызовите Initialize() перед использованием.");

            return _serviceProvider.GetService<T>();
        }

        public static object GetService(Type serviceType)
        {
            if (_serviceProvider == null)
                throw new InvalidOperationException("ServiceProvider не инициализирован. Вызовите Initialize() перед использованием.");

            return _serviceProvider.GetService(serviceType);
        }

        public static IServiceProvider GetServiceProvider() => _serviceProvider;

        public static IServiceScope CreateScope() => _serviceProvider.CreateScope();
    }
}



--- Файл: ComponentVersionService.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Agrovent.DAL;
using Agrovent.DAL.Entities.Components;
using Agrovent.DAL.Repositories;
using Agrovent.Infrastructure.Interfaces;
using Agrovent.Infrastructure.Interfaces.Components;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.ViewModels.Components;
using Microsoft.EntityFrameworkCore.Storage;
using Microsoft.Extensions.Logging;

namespace Agrovent.Services
{
    public class ComponentVersionService : IAGR_ComponentVersionService
    {
        private readonly IUnitOfWork _unitOfWork;
        private readonly ILogger<ComponentVersionService> _logger;
        private readonly DataContext _context;

        public ComponentVersionService(IUnitOfWork unitOfWork, ILogger<ComponentVersionService> logger, DataContext context)
        {
            _unitOfWork = unitOfWork;
            _logger = logger;
            _context = context;
        }

        public async Task<bool> CheckAndSaveComponentAsync(IAGR_BaseComponent component)
        {
            using var transaction = await _unitOfWork.BeginTransactionAsync();

            try
            {
                _logger.LogInformation($"Начинаем сохранение компонента: {component.PartNumber}");

                // 1. Проверяем, изменился ли компонент
                var hasChanged = await _unitOfWork.ComponentRepository.HasComponentChanged(component);

                if (!hasChanged)
                {
                    _logger.LogInformation($"Компонент не изменился: {component.PartNumber}");
                    await _unitOfWork.RollbackTransactionAsync();
                    return false;
                }

                // 2. Получаем существующую версию (в рамках той же транзакции)
                var existingVersion = await _unitOfWork.ComponentRepository.GetExistingVersion(component);

                if (existingVersion != null)
                {
                    _logger.LogInformation($"Компонент уже существует: {component.PartNumber} v{existingVersion.Version}");
                    await _unitOfWork.RollbackTransactionAsync();
                    return false;
                }

                // 3. Сохраняем компонент
                var savedVersion = await _unitOfWork.ComponentRepository.SaveComponent(component, component.HashSum);

                // 4. Сохраняем все изменения
                var savedCount = await _unitOfWork.CompleteAsync();
                _logger.LogInformation($"Сохранено {savedCount} записей для компонента {component.PartNumber}");

                // 5. Проверяем, что Id установлены
                if (savedVersion.Id == 0)
                {
                    _logger.LogError($"Id компонента {component.PartNumber} не установлен!");
                    await _unitOfWork.RollbackTransactionAsync();
                    return false;
                }

                await _unitOfWork.CommitTransactionAsync();

                _logger.LogInformation($"Компонент успешно сохранен: {component.PartNumber}, Id: {savedVersion.Id}");
                return true;
            }
            catch (Exception ex)
            {
                await _unitOfWork.RollbackTransactionAsync();
                _logger.LogError(ex, $"Ошибка при сохранении компонента: {component.PartNumber}");
                throw;
            }
        }

        public async Task<bool> CheckAndSaveAssemblyAsync(AGR_AssemblyComponentVM assembly)
        {
            using var transaction = await _unitOfWork.BeginTransactionAsync();

            try
            {
                _logger.LogInformation($"Начинаем сохранение сборки: {assembly.PartNumber}");

                // 1. Проверяем, изменилась ли сборка
                var hasChanged = await _unitOfWork.ComponentRepository.HasComponentChanged(assembly);

                if (!hasChanged)
                {
                    _logger.LogInformation($"Сборка не изменилась: {assembly.PartNumber}");
                    await _unitOfWork.RollbackTransactionAsync();
                    return false;
                }

                // 2. Получаем существующую версию сборки
                var existingVersion = await _unitOfWork.ComponentRepository.GetExistingVersion(assembly);

                if (existingVersion != null)
                {
                    _logger.LogInformation($"Сборка уже существует: {assembly.PartNumber} v{existingVersion.Version}");
                    await _unitOfWork.RollbackTransactionAsync();
                    return false;
                }

                // 3. Сохраняем структуру сборки
                await _unitOfWork.ComponentRepository.SaveAssemblyStructure(assembly, assembly.AGR_TopComponents);

                // 4. Сохраняем все изменения и коммитим транзакцию
                await _unitOfWork.CompleteAsync();
                await _unitOfWork.CommitTransactionAsync();

                _logger.LogInformation($"Сборка успешно сохранена: {assembly.PartNumber}");
                return true;
            }
            catch (Exception ex)
            {
                await _unitOfWork.RollbackTransactionAsync();
                _logger.LogError(ex, $"Ошибка при сохранении сборки: {assembly.PartNumber}");
                throw;
            }
        }

        public async Task<ComponentVersion?> GetComponentVersionAsync(string partNumber, int version)
        {
            try
            {
                _logger.LogDebug($"Запрос версии компонента: {partNumber} v{version}");

                // Этот метод только для чтения, поэтому не используем транзакцию
                return await _unitOfWork.ComponentRepository.GetComponentVersion(partNumber, version);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при получении версии компонента: {partNumber}");
                throw;
            }
        }

        public async Task<bool> HasComponentChangedAsync(IAGR_BaseComponent component)
        {
            try
            {
                _logger.LogDebug($"Проверка изменений компонента: {component.PartNumber}");

                // Этот метод только для чтения, поэтому не используем транзакцию
                return await _unitOfWork.ComponentRepository.HasComponentChanged(component);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при проверке изменений компонента: {component.PartNumber}");
                throw;
            }
        }

        // Дополнительный метод для получения последней версии компонента
        public async Task<ComponentVersion?> GetLatestComponentVersionAsync(string partNumber)
        {
            try
            {
                _logger.LogDebug($"Запрос последней версии компонента: {partNumber}");
                return await _unitOfWork.ComponentRepository.GetLatestComponentVersion(partNumber);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при получении последней версии компонента: {partNumber}");
                throw;
            }
        }

        // Дополнительный метод для получения структуры сборки
        public async Task<List<AssemblyStructure>> GetAssemblyStructureAsync(string assemblyPartNumber, int version)
        {
            try
            {
                _logger.LogDebug($"Запрос структуры сборки: {assemblyPartNumber} v{version}");
                return await _unitOfWork.ComponentRepository.GetAssemblyStructure(assemblyPartNumber, version);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при получении структуры сборки: {assemblyPartNumber}");
                throw;
            }
        }
    }
}



--- Файл: ServiceConfiguration.cs ---
==============================================================
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using Agrovent.DAL;
using Agrovent.DAL.Repositories;
using Agrovent.Services;
using Microsoft.EntityFrameworkCore;
using Agrovent.Infrastructure.Interfaces;
using System.Reflection;
using System.IO;
using Xarial.XCad.Documents;
using Agrovent.Infrastructure.Interfaces.Services;
using Agrovent.ViewModels.TaskPane;

namespace Agrovent
{
    public static class ServiceConfiguration
    {
        public static IServiceCollection ConfigureServices(this IServiceCollection services)
        {
            // 1. Конфигурация
            var appStr = Path.GetDirectoryName(System.Reflection.Assembly.GetExecutingAssembly().Location);
            var configuration = new ConfigurationBuilder()
                .SetBasePath(appStr)
                .AddJsonFile("appsettings.json", optional: false, reloadOnChange: true)
                .Build();

            services.AddSingleton<IConfiguration>(configuration);

            // 2. Логирование
            services.AddLogging(configure =>
            {
                configure.AddConsole();
                configure.AddDebug();
                configure.SetMinimumLevel(LogLevel.Debug);
            });

            // 3. База данных
            services.AddDbContext<DataContext>(options =>
            {
                options.UseNpgsql(configuration.GetConnectionString("DefaultConnection"));
                options.EnableSensitiveDataLogging();
                options.UseQueryTrackingBehavior(QueryTrackingBehavior.NoTracking);
            });

            // 4. Репозитории
            services.AddScoped<IAGR_ComponentRepository, ComponentRepository>();
            services.AddScoped<IUnitOfWork, UnitOfWork>();
            services.AddScoped<IAGR_ComponentVersionService, ComponentVersionService>();

            // 5. Сервисы
            services.AddScoped<IAGR_ComponentViewModelFactory, AGR_ComponentViewModelFactory>();
            services.AddSingleton<IAGR_ComponentViewModelCache, AGR_ComponentViewModelCache>();
            services.AddScoped<IAGR_ComponentViewModelFactory, AGR_ComponentViewModelFactory>();

            // 6. ViewModels (если нужно)
            services.AddScoped<AGR_TaskPaneViewModel>();
            // services.AddTransient<AGR_AssemblyComponentVM>();
            // services.AddTransient<AGR_PartComponentVM>();

            return services;
        }
    }
}



--- Файл: ViewModelLocator.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.ComponentModel.Design;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Agrovent.Infrastructure.Interfaces.Services;
using Agrovent.Services;
using Agrovent.ViewModels.TaskPane;

namespace Agrovent.ViewModels
{
    public class ViewModelLocator
    {
        public AGR_TaskPaneViewModel TaskPaneVM => AGR_ServiceContainer.GetService<AGR_TaskPaneViewModel>();

        public void RefreshViewModelCache()
        {
            var cache = AGR_ServiceContainer.GetService<IAGR_ComponentViewModelCache>();
            cache.Clear();
        }
    }
}




--- Файл: 20251206122349_InitialCreate.cs ---
==============================================================
using System;
using Microsoft.EntityFrameworkCore.Migrations;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

namespace Agrovent.DAL.Migrations
{
    /// <inheritdoc />
    public partial class InitialCreate : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.CreateTable(
                name: "AvaArticles",
                columns: table => new
                {
                    Article = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    PartNumber = table.Column<string>(type: "text", nullable: true),
                    Name = table.Column<string>(type: "text", nullable: false),
                    Count = table.Column<decimal>(type: "numeric", nullable: true),
                    UOM = table.Column<string>(type: "text", nullable: false),
                    Type = table.Column<string>(type: "text", nullable: false),
                    Folder = table.Column<string>(type: "text", nullable: false),
                    Brand = table.Column<string>(type: "text", nullable: false),
                    Company = table.Column<string>(type: "text", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AvaArticles", x => x.Article);
                });

            migrationBuilder.CreateTable(
                name: "Components",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    PartNumber = table.Column<string>(type: "text", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Components", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "ComponentVersions",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    ComponentId = table.Column<int>(type: "integer", nullable: false),
                    Version = table.Column<int>(type: "integer", nullable: false),
                    HashSum = table.Column<int>(type: "integer", nullable: false),
                    Name = table.Column<string>(type: "text", nullable: false),
                    ConfigName = table.Column<string>(type: "text", nullable: false),
                    AvaArticleArticle = table.Column<int>(type: "integer", nullable: true),
                    ComponentType = table.Column<int>(type: "integer", nullable: false),
                    AvaType = table.Column<int>(type: "integer", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ComponentVersions", x => x.Id);
                    table.ForeignKey(
                        name: "FK_ComponentVersions_AvaArticles_AvaArticleArticle",
                        column: x => x.AvaArticleArticle,
                        principalTable: "AvaArticles",
                        principalColumn: "Article");
                    table.ForeignKey(
                        name: "FK_ComponentVersions_Components_ComponentId",
                        column: x => x.ComponentId,
                        principalTable: "Components",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "AssemblyStructures",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    AssemblyVersionId = table.Column<int>(type: "integer", nullable: false),
                    ComponentVersionId = table.Column<int>(type: "integer", nullable: false),
                    Quantity = table.Column<int>(type: "integer", nullable: false),
                    Level = table.Column<int>(type: "integer", nullable: false),
                    ParentStructureId = table.Column<int>(type: "integer", nullable: true),
                    OrderIndex = table.Column<int>(type: "integer", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AssemblyStructures", x => x.Id);
                    table.ForeignKey(
                        name: "FK_AssemblyStructures_AssemblyStructures_ParentStructureId",
                        column: x => x.ParentStructureId,
                        principalTable: "AssemblyStructures",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_AssemblyStructures_ComponentVersions_AssemblyVersionId",
                        column: x => x.AssemblyVersionId,
                        principalTable: "ComponentVersions",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_AssemblyStructures_ComponentVersions_ComponentVersionId",
                        column: x => x.ComponentVersionId,
                        principalTable: "ComponentVersions",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "ComponentFiles",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    ComponentVersionId = table.Column<int>(type: "integer", nullable: false),
                    FileType = table.Column<int>(type: "integer", nullable: false),
                    FilePath = table.Column<string>(type: "text", nullable: false),
                    LastModified = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    FileSize = table.Column<long>(type: "bigint", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ComponentFiles", x => x.Id);
                    table.ForeignKey(
                        name: "FK_ComponentFiles_ComponentVersions_ComponentVersionId",
                        column: x => x.ComponentVersionId,
                        principalTable: "ComponentVersions",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "ComponentMaterials",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    ComponentVersionId = table.Column<int>(type: "integer", nullable: false),
                    BaseMaterial = table.Column<string>(type: "text", nullable: true),
                    BaseMaterialCount = table.Column<decimal>(type: "numeric", nullable: false),
                    Paint = table.Column<string>(type: "text", nullable: true),
                    PaintCount = table.Column<decimal>(type: "numeric", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ComponentMaterials", x => x.Id);
                    table.ForeignKey(
                        name: "FK_ComponentMaterials_ComponentVersions_ComponentVersionId",
                        column: x => x.ComponentVersionId,
                        principalTable: "ComponentVersions",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "ComponentProperties",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    ComponentVersionId = table.Column<int>(type: "integer", nullable: false),
                    Name = table.Column<string>(type: "text", nullable: false),
                    Value = table.Column<string>(type: "text", nullable: false),
                    Type = table.Column<int>(type: "integer", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ComponentProperties", x => x.Id);
                    table.ForeignKey(
                        name: "FK_ComponentProperties_ComponentVersions_ComponentVersionId",
                        column: x => x.ComponentVersionId,
                        principalTable: "ComponentVersions",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateIndex(
                name: "IX_AssemblyStructures_AssemblyVersionId",
                table: "AssemblyStructures",
                column: "AssemblyVersionId");

            migrationBuilder.CreateIndex(
                name: "IX_AssemblyStructures_ComponentVersionId",
                table: "AssemblyStructures",
                column: "ComponentVersionId");

            migrationBuilder.CreateIndex(
                name: "IX_AssemblyStructures_ParentStructureId",
                table: "AssemblyStructures",
                column: "ParentStructureId");

            migrationBuilder.CreateIndex(
                name: "IX_ComponentFiles_ComponentVersionId",
                table: "ComponentFiles",
                column: "ComponentVersionId");

            migrationBuilder.CreateIndex(
                name: "IX_ComponentMaterials_ComponentVersionId",
                table: "ComponentMaterials",
                column: "ComponentVersionId",
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_ComponentProperties_ComponentVersionId",
                table: "ComponentProperties",
                column: "ComponentVersionId");

            migrationBuilder.CreateIndex(
                name: "IX_Components_PartNumber",
                table: "Components",
                column: "PartNumber",
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_ComponentVersions_AvaArticleArticle",
                table: "ComponentVersions",
                column: "AvaArticleArticle");

            migrationBuilder.CreateIndex(
                name: "IX_ComponentVersions_ComponentId_Version",
                table: "ComponentVersions",
                columns: new[] { "ComponentId", "Version" },
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_ComponentVersions_HashSum",
                table: "ComponentVersions",
                column: "HashSum",
                unique: true);
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropTable(
                name: "AssemblyStructures");

            migrationBuilder.DropTable(
                name: "ComponentFiles");

            migrationBuilder.DropTable(
                name: "ComponentMaterials");

            migrationBuilder.DropTable(
                name: "ComponentProperties");

            migrationBuilder.DropTable(
                name: "ComponentVersions");

            migrationBuilder.DropTable(
                name: "AvaArticles");

            migrationBuilder.DropTable(
                name: "Components");
        }
    }
}




--- Файл: 20251206122349_InitialCreate.Designer.cs ---
==============================================================
// <auto-generated />
using System;
using Agrovent.DAL;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

namespace Agrovent.DAL.Migrations
{
    [DbContext(typeof(DataContext))]
    [Migration("20251206122349_InitialCreate")]
    partial class InitialCreate
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "7.0.20")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("AssemblyVersionId")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Level")
                        .HasColumnType("integer");

                    b.Property<int>("OrderIndex")
                        .HasColumnType("integer");

                    b.Property<int?>("ParentStructureId")
                        .HasColumnType("integer");

                    b.Property<int>("Quantity")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("AssemblyVersionId");

                    b.HasIndex("ComponentVersionId");

                    b.HasIndex("ParentStructureId");

                    b.ToTable("AssemblyStructures");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AvaArticleModel", b =>
                {
                    b.Property<int>("Article")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Article"));

                    b.Property<string>("Brand")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Company")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal?>("Count")
                        .HasColumnType("numeric");

                    b.Property<string>("Folder")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PartNumber")
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UOM")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Article");

                    b.ToTable("AvaArticles");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.Component", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("PartNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("PartNumber")
                        .IsUnique();

                    b.ToTable("Components");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentFile", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FilePath")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("FileSize")
                        .HasColumnType("bigint");

                    b.Property<int>("FileType")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("LastModified")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId");

                    b.ToTable("ComponentFiles");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentMaterial", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("BaseMaterial")
                        .HasColumnType("text");

                    b.Property<decimal>("BaseMaterialCount")
                        .HasColumnType("numeric");

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Paint")
                        .HasColumnType("text");

                    b.Property<decimal?>("PaintCount")
                        .HasColumnType("numeric");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId")
                        .IsUnique();

                    b.ToTable("ComponentMaterials");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentProperty", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Type")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId");

                    b.ToTable("ComponentProperties");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int?>("AvaArticleArticle")
                        .HasColumnType("integer");

                    b.Property<int>("AvaType")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentId")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentType")
                        .HasColumnType("integer");

                    b.Property<string>("ConfigName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("HashSum")
                        .HasColumnType("integer");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Version")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("AvaArticleArticle");

                    b.HasIndex("HashSum")
                        .IsUnique();

                    b.HasIndex("ComponentId", "Version")
                        .IsUnique();

                    b.ToTable("ComponentVersions");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "AssemblyVersion")
                        .WithMany()
                        .HasForeignKey("AssemblyVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany()
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Agrovent.DAL.Entities.Components.AssemblyStructure", "ParentStructure")
                        .WithMany("ChildStructures")
                        .HasForeignKey("ParentStructureId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.Navigation("AssemblyVersion");

                    b.Navigation("ComponentVersion");

                    b.Navigation("ParentStructure");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentFile", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany("Files")
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentMaterial", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithOne("Material")
                        .HasForeignKey("Agrovent.DAL.Entities.Components.ComponentMaterial", "ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentProperty", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany("Properties")
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.AvaArticleModel", "AvaArticle")
                        .WithMany()
                        .HasForeignKey("AvaArticleArticle");

                    b.HasOne("Agrovent.DAL.Entities.Components.Component", "Component")
                        .WithMany("Versions")
                        .HasForeignKey("ComponentId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("AvaArticle");

                    b.Navigation("Component");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.Navigation("ChildStructures");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.Component", b =>
                {
                    b.Navigation("Versions");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.Navigation("Files");

                    b.Navigation("Material");

                    b.Navigation("Properties");
                });
#pragma warning restore 612, 618
        }
    }
}




--- Файл: 20251209115402_InitialCreate2.cs ---
==============================================================
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

namespace Agrovent.DAL.Migrations
{
    /// <inheritdoc />
    public partial class InitialCreate2 : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {

        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {

        }
    }
}




--- Файл: 20251209115402_InitialCreate2.Designer.cs ---
==============================================================
// <auto-generated />
using System;
using Agrovent.DAL;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

namespace Agrovent.DAL.Migrations
{
    [DbContext(typeof(DataContext))]
    [Migration("20251209115402_InitialCreate2")]
    partial class InitialCreate2
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "7.0.20")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("AssemblyVersionId")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Level")
                        .HasColumnType("integer");

                    b.Property<int>("OrderIndex")
                        .HasColumnType("integer");

                    b.Property<int?>("ParentStructureId")
                        .HasColumnType("integer");

                    b.Property<int>("Quantity")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("AssemblyVersionId");

                    b.HasIndex("ComponentVersionId");

                    b.HasIndex("ParentStructureId");

                    b.ToTable("AssemblyStructures");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AvaArticleModel", b =>
                {
                    b.Property<int>("Article")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Article"));

                    b.Property<string>("Brand")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Company")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal?>("Count")
                        .HasColumnType("numeric");

                    b.Property<string>("Folder")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PartNumber")
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UOM")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Article");

                    b.ToTable("AvaArticles");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.Component", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("PartNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("PartNumber")
                        .IsUnique();

                    b.ToTable("Components");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentFile", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FilePath")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("FileSize")
                        .HasColumnType("bigint");

                    b.Property<int>("FileType")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("LastModified")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId");

                    b.ToTable("ComponentFiles");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentMaterial", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("BaseMaterial")
                        .HasColumnType("text");

                    b.Property<decimal>("BaseMaterialCount")
                        .HasColumnType("numeric");

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Paint")
                        .HasColumnType("text");

                    b.Property<decimal?>("PaintCount")
                        .HasColumnType("numeric");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId")
                        .IsUnique();

                    b.ToTable("ComponentMaterials");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentProperty", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Type")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId");

                    b.ToTable("ComponentProperties");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int?>("AvaArticleArticle")
                        .HasColumnType("integer");

                    b.Property<int>("AvaType")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentId")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentType")
                        .HasColumnType("integer");

                    b.Property<string>("ConfigName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("HashSum")
                        .HasColumnType("integer");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Version")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("AvaArticleArticle");

                    b.HasIndex("HashSum")
                        .IsUnique();

                    b.HasIndex("ComponentId", "Version")
                        .IsUnique();

                    b.ToTable("ComponentVersions");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "AssemblyVersion")
                        .WithMany()
                        .HasForeignKey("AssemblyVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany()
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Agrovent.DAL.Entities.Components.AssemblyStructure", "ParentStructure")
                        .WithMany("ChildStructures")
                        .HasForeignKey("ParentStructureId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.Navigation("AssemblyVersion");

                    b.Navigation("ComponentVersion");

                    b.Navigation("ParentStructure");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentFile", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany("Files")
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentMaterial", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithOne("Material")
                        .HasForeignKey("Agrovent.DAL.Entities.Components.ComponentMaterial", "ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentProperty", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany("Properties")
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.AvaArticleModel", "AvaArticle")
                        .WithMany()
                        .HasForeignKey("AvaArticleArticle");

                    b.HasOne("Agrovent.DAL.Entities.Components.Component", "Component")
                        .WithMany("Versions")
                        .HasForeignKey("ComponentId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("AvaArticle");

                    b.Navigation("Component");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.Navigation("ChildStructures");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.Component", b =>
                {
                    b.Navigation("Versions");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.Navigation("Files");

                    b.Navigation("Material");

                    b.Navigation("Properties");
                });
#pragma warning restore 612, 618
        }
    }
}




--- Файл: 20251210072611_FixAssemblyStructureForeignKey.cs ---
==============================================================
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

namespace Agrovent.DAL.Migrations
{
    /// <inheritdoc />
    public partial class FixAssemblyStructureForeignKey : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropForeignKey(
                name: "FK_AssemblyStructures_AssemblyStructures_ParentStructureId",
                table: "AssemblyStructures");

            migrationBuilder.AddForeignKey(
                name: "FK_AssemblyStructures_AssemblyStructures_ParentStructureId",
                table: "AssemblyStructures",
                column: "ParentStructureId",
                principalTable: "AssemblyStructures",
                principalColumn: "Id",
                onDelete: ReferentialAction.Restrict);
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropForeignKey(
                name: "FK_AssemblyStructures_AssemblyStructures_ParentStructureId",
                table: "AssemblyStructures");

            migrationBuilder.AddForeignKey(
                name: "FK_AssemblyStructures_AssemblyStructures_ParentStructureId",
                table: "AssemblyStructures",
                column: "ParentStructureId",
                principalTable: "AssemblyStructures",
                principalColumn: "Id",
                onDelete: ReferentialAction.Cascade);
        }
    }
}




--- Файл: 20251210072611_FixAssemblyStructureForeignKey.Designer.cs ---
==============================================================
// <auto-generated />
using System;
using Agrovent.DAL;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

namespace Agrovent.DAL.Migrations
{
    [DbContext(typeof(DataContext))]
    [Migration("20251210072611_FixAssemblyStructureForeignKey")]
    partial class FixAssemblyStructureForeignKey
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "7.0.20")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("AssemblyVersionId")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Level")
                        .HasColumnType("integer");

                    b.Property<int>("OrderIndex")
                        .HasColumnType("integer");

                    b.Property<int?>("ParentStructureId")
                        .HasColumnType("integer");

                    b.Property<int>("Quantity")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("AssemblyVersionId");

                    b.HasIndex("ComponentVersionId");

                    b.HasIndex("ParentStructureId");

                    b.ToTable("AssemblyStructures");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AvaArticleModel", b =>
                {
                    b.Property<int>("Article")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Article"));

                    b.Property<string>("Brand")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Company")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal?>("Count")
                        .HasColumnType("numeric");

                    b.Property<string>("Folder")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PartNumber")
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UOM")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Article");

                    b.ToTable("AvaArticles");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.Component", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("PartNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("PartNumber")
                        .IsUnique();

                    b.ToTable("Components");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentFile", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FilePath")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("FileSize")
                        .HasColumnType("bigint");

                    b.Property<int>("FileType")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("LastModified")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId");

                    b.ToTable("ComponentFiles");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentMaterial", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("BaseMaterial")
                        .HasColumnType("text");

                    b.Property<decimal>("BaseMaterialCount")
                        .HasColumnType("numeric");

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Paint")
                        .HasColumnType("text");

                    b.Property<decimal?>("PaintCount")
                        .HasColumnType("numeric");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId")
                        .IsUnique();

                    b.ToTable("ComponentMaterials");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentProperty", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Type")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId");

                    b.ToTable("ComponentProperties");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int?>("AvaArticleArticle")
                        .HasColumnType("integer");

                    b.Property<int>("AvaType")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentId")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentType")
                        .HasColumnType("integer");

                    b.Property<string>("ConfigName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("HashSum")
                        .HasColumnType("integer");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Version")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("AvaArticleArticle");

                    b.HasIndex("HashSum")
                        .IsUnique();

                    b.HasIndex("ComponentId", "Version")
                        .IsUnique();

                    b.ToTable("ComponentVersions");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "AssemblyVersion")
                        .WithMany()
                        .HasForeignKey("AssemblyVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany()
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Agrovent.DAL.Entities.Components.AssemblyStructure", "ParentStructure")
                        .WithMany("ChildStructures")
                        .HasForeignKey("ParentStructureId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("AssemblyVersion");

                    b.Navigation("ComponentVersion");

                    b.Navigation("ParentStructure");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentFile", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany("Files")
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentMaterial", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithOne("Material")
                        .HasForeignKey("Agrovent.DAL.Entities.Components.ComponentMaterial", "ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentProperty", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany("Properties")
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.AvaArticleModel", "AvaArticle")
                        .WithMany()
                        .HasForeignKey("AvaArticleArticle");

                    b.HasOne("Agrovent.DAL.Entities.Components.Component", "Component")
                        .WithMany("Versions")
                        .HasForeignKey("ComponentId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("AvaArticle");

                    b.Navigation("Component");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.Navigation("ChildStructures");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.Component", b =>
                {
                    b.Navigation("Versions");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.Navigation("Files");

                    b.Navigation("Material");

                    b.Navigation("Properties");
                });
#pragma warning restore 612, 618
        }
    }
}




--- Файл: DataContextModelSnapshot.cs ---
==============================================================
// <auto-generated />
using System;
using Agrovent.DAL;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

namespace Agrovent.DAL.Migrations
{
    [DbContext(typeof(DataContext))]
    partial class DataContextModelSnapshot : ModelSnapshot
    {
        protected override void BuildModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "7.0.20")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("AssemblyVersionId")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Level")
                        .HasColumnType("integer");

                    b.Property<int>("OrderIndex")
                        .HasColumnType("integer");

                    b.Property<int?>("ParentStructureId")
                        .HasColumnType("integer");

                    b.Property<int>("Quantity")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("AssemblyVersionId");

                    b.HasIndex("ComponentVersionId");

                    b.HasIndex("ParentStructureId");

                    b.ToTable("AssemblyStructures");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AvaArticleModel", b =>
                {
                    b.Property<int>("Article")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Article"));

                    b.Property<string>("Brand")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Company")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal?>("Count")
                        .HasColumnType("numeric");

                    b.Property<string>("Folder")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PartNumber")
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UOM")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Article");

                    b.ToTable("AvaArticles");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.Component", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("PartNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("PartNumber")
                        .IsUnique();

                    b.ToTable("Components");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentFile", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FilePath")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("FileSize")
                        .HasColumnType("bigint");

                    b.Property<int>("FileType")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("LastModified")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId");

                    b.ToTable("ComponentFiles");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentMaterial", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("BaseMaterial")
                        .HasColumnType("text");

                    b.Property<decimal>("BaseMaterialCount")
                        .HasColumnType("numeric");

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Paint")
                        .HasColumnType("text");

                    b.Property<decimal?>("PaintCount")
                        .HasColumnType("numeric");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId")
                        .IsUnique();

                    b.ToTable("ComponentMaterials");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentProperty", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ComponentVersionId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Type")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("ComponentVersionId");

                    b.ToTable("ComponentProperties");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int?>("AvaArticleArticle")
                        .HasColumnType("integer");

                    b.Property<int>("AvaType")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentId")
                        .HasColumnType("integer");

                    b.Property<int>("ComponentType")
                        .HasColumnType("integer");

                    b.Property<string>("ConfigName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("HashSum")
                        .HasColumnType("integer");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Version")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("AvaArticleArticle");

                    b.HasIndex("HashSum")
                        .IsUnique();

                    b.HasIndex("ComponentId", "Version")
                        .IsUnique();

                    b.ToTable("ComponentVersions");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "AssemblyVersion")
                        .WithMany()
                        .HasForeignKey("AssemblyVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany()
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Agrovent.DAL.Entities.Components.AssemblyStructure", "ParentStructure")
                        .WithMany("ChildStructures")
                        .HasForeignKey("ParentStructureId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("AssemblyVersion");

                    b.Navigation("ComponentVersion");

                    b.Navigation("ParentStructure");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentFile", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany("Files")
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentMaterial", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithOne("Material")
                        .HasForeignKey("Agrovent.DAL.Entities.Components.ComponentMaterial", "ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentProperty", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.ComponentVersion", "ComponentVersion")
                        .WithMany("Properties")
                        .HasForeignKey("ComponentVersionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ComponentVersion");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.HasOne("Agrovent.DAL.Entities.Components.AvaArticleModel", "AvaArticle")
                        .WithMany()
                        .HasForeignKey("AvaArticleArticle");

                    b.HasOne("Agrovent.DAL.Entities.Components.Component", "Component")
                        .WithMany("Versions")
                        .HasForeignKey("ComponentId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("AvaArticle");

                    b.Navigation("Component");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.AssemblyStructure", b =>
                {
                    b.Navigation("ChildStructures");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.Component", b =>
                {
                    b.Navigation("Versions");
                });

            modelBuilder.Entity("Agrovent.DAL.Entities.Components.ComponentVersion", b =>
                {
                    b.Navigation("Files");

                    b.Navigation("Material");

                    b.Navigation("Properties");
                });
#pragma warning restore 612, 618
        }
    }
}




--- Файл: UnitOfWork.cs ---
==============================================================
using Agrovent.DAL.Repositories;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Storage;
using Xarial.XCad.Documents;

namespace Agrovent.DAL
{
    public interface IUnitOfWork : IDisposable
    {
        IAGR_ComponentRepository ComponentRepository { get; }
        Task<int> CompleteAsync();
        Task<IDbContextTransaction> BeginTransactionAsync();
        Task CommitTransactionAsync();
        Task RollbackTransactionAsync();
    }

    public class UnitOfWork : IUnitOfWork
    {
        private readonly DataContext _context;
        private IDbContextTransaction _transaction;
        private bool _disposed = false;

        public IAGR_ComponentRepository ComponentRepository { get; }

        public UnitOfWork(DataContext context, IAGR_ComponentRepository componentRepository)
        {
            _context = context;
            ComponentRepository = componentRepository;
        }

        public async Task<int> CompleteAsync()
        {
            try
            {
                return await _context.SaveChangesAsync();
            }
            catch (DbUpdateException ex)
            {
                // Логируем ошибки базы данных
                throw new Exception("Ошибка при сохранении изменений в базе данных", ex);
            }
        }

        public async Task<IDbContextTransaction> BeginTransactionAsync()
        {
            _transaction = await _context.Database.BeginTransactionAsync();
            return _transaction;
        }

        public async Task CommitTransactionAsync()
        {
            if (_transaction != null)
            {
                await _transaction.CommitAsync();
                await _transaction.DisposeAsync();
                _transaction = null;
            }
        }

        public async Task RollbackTransactionAsync()
        {
            if (_transaction != null)
            {
                await _transaction.RollbackAsync();
                await _transaction.DisposeAsync();
                _transaction = null;
            }
        }

        public void Dispose()
        {
            Dispose(true);
            GC.SuppressFinalize(this);
        }

        protected virtual void Dispose(bool disposing)
        {
            if (!_disposed)
            {
                if (disposing)
                {
                    _transaction?.Dispose();
                    _context.Dispose();
                }
                _disposed = true;
            }
        }
    }
}



--- Файл: AGR_AvaType_e.cs ---
==============================================================
namespace Agrovent.Infrastructure.Enums
{
    public enum AGR_AvaType_e
    {
        Production = 3,
        Component = 5,
        DontBuy = 32,
        Purchased = 20021,
        VirtualComponent = 50625
    }
}



--- Файл: AGR_ComponentBOMState_e.cs ---
==============================================================
namespace Agrovent.Infrastructure.Enums
{
    public enum AGR_ComponentBOMState_e
    {
        Normal,
        Excluded
    }
}




--- Файл: AGR_ComponentType_e.cs ---
==============================================================
namespace Agrovent.Infrastructure.Enums
{
    public enum AGR_ComponentType_e
    {
        Assembly,
        Part,
        SheetMetallPart,
        Purchased,
        NA
    }
}




--- Файл: AGR_FileType_e.cs ---
==============================================================
namespace Agrovent.Infrastructure.Enums
{
    public enum AGR_FileType_e
    {
        CurrentModel,      // Текущая модель
        CurrentDrawing,    // Текущий чертеж
        StorageModel,      // Модель в хранилище
        StorageDrawing,    // Чертеж в хранилище
        ProductionModel,   // Модель в производстве
        ProductionDrawing  // Чертеж в производстве
    }
}




--- Файл: AGR_PropertyNames.cs ---
==============================================================
namespace Agrovent.Infrastructure.Enums
{
    public static class AGR_PropertyNames
    {
        public const string Name = "Наименование";
        public const string Partnumber = "Обозначение";
        public const string AvaType = "Признак";
        public const string Extension = "Расширение";
        public const string FilePath = "Путь файла";
        public const string Material = "Материал";
        public const string BlankMass = "Масса";
        public const string BlankLen = "Заготовка - длина(мм)";
        public const string BlankWid = "Заготовка - ширина(мм)";
        public const string BlankThick = "Заготовка - толщина(мм)";
        public const string BlankContSum = "Заготовка - сумма контуров(мм)";
        public const string BlankBends = "Заготовка - Сгибы(шт)";
        public const string BlankArea = "Заготовка - площадь(м2)";
        public const string BlankVolume = "Заготовка - объём(м3)";
        public const string Color = "Цвет покраски";
        public const string Article = "Артикул";
        public const string Version = "Версия";
        public const string HashSum = "Хэш-сумма";
        public const string PDM_Partnumber = "Номер ДСЕ";
    }
}




--- Файл: AGR_PropertyType_e.cs ---
==============================================================
namespace Agrovent.Infrastructure.Enums
{
    public enum AGR_PropertyType_e
    {
        String,
        Number,
        Boolean,
        Date
    }
}




--- Файл: IAGR_AvaArticleModel.cs ---
==============================================================
namespace Agrovent.Infrastructure.Interfaces
{
    public interface IAGR_AvaArticleModel
    {
        int Article { get; set; }
        string Brand { get; set; }
        string Company { get; set; }
        decimal? Count { get; set; }
        string Folder { get; set; }
        string Name { get; set; }
        string? PartNumber { get; set; }
        string Type { get; set; }
        string UOM { get; set; }
    }
}



--- Файл: RelayCommand.cs ---
==============================================================
using System.Windows;
using Agrovent.Infrastructure.Commands.Base;

namespace Agrovent.Infrastructure.Commands
{
    public class RelayCommand : BaseCommand
    {
        private readonly Action<object> _Execute;
        private readonly Func<object, bool> _CanExecute;

        public RelayCommand(Action<object> Execute, Func<object, bool> CanExecute = null)
        {
            _Execute = Execute ?? throw new ArgumentNullException(nameof(Execute));
            _CanExecute = CanExecute;
        }
        public override bool CanExecute(object? parameter) => _CanExecute?.Invoke(parameter) ?? true;

        public override void Execute(object? parameter)
        {
            if (!CanExecute(parameter)) return;
            _Execute(parameter);
        }
    }
}




--- Файл: AGR_AvaTypeConverter.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Data;
using Agrovent.Infrastructure.Enums;

namespace Agrovent.Infrastructure.Converters
{
    internal class AGR_AvaTypeConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value != "")
            {
                Enum type = (AGR_AvaType_e)value;
                switch (type)
                {
                    case AGR_AvaType_e.Production:
                        return "Продукция";
                    case AGR_AvaType_e.Component:
                        return "Произведено";
                    case AGR_AvaType_e.Purchased:
                        return "Покупное";
                    case AGR_AvaType_e.VirtualComponent:
                        return "Виртуальный компонент";
                    case AGR_AvaType_e.DontBuy:
                        return "Не покупать";
                }
            }
            return null;
        }

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value is not null)
            {
                return value;
            }
            return null;
        }
    }
}




--- Файл: AGR_ComponentCountConverter.cs ---
==============================================================
// AGR_ComponentCountConverter.cs
using System;
using System.Collections;
using System.Globalization;
using System.Linq;
using System.Windows.Data;

namespace Agrovent.Infrastructure.Converters
{
    public class AGR_ComponentCountConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value is int count && parameter is string typeParam)
            {
                if (System.ComponentModel.DesignerProperties.GetIsInDesignMode(new System.Windows.DependencyObject()))
                    return "0";

                // В реальном приложении здесь будет логика фильтрации
                // Так как мы не можем получить доступ к коллекции из конвертера,
                // лучше сделать это в ViewModel
                return "0";
            }

            return "0";
        }

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            throw new NotImplementedException();
        }
    }
}



--- Файл: AGR_ComponentTypeConverter.cs ---
==============================================================
using System.Globalization;
using System.Windows.Data;
using Agrovent.Infrastructure.Enums;

namespace Agrovent.Infrastructure.Converters
{
    internal class AGR_ComponentTypeConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value != "")
            {
                Enum type = (AGR_ComponentType_e)value;
                switch (type)
                {
                    case AGR_ComponentType_e.Assembly:
                        return "Сборочные единицы";
                    case AGR_ComponentType_e.Part:
                        return "Детали";
                    case AGR_ComponentType_e.Purchased:
                        return "Покупное";
                    case AGR_ComponentType_e.SheetMetallPart:
                        return "Листовые детали";
                }
            }
            return null;
        }

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value is not null)
            {
                return value;
            }
            return null;
        }
    }
}




--- Файл: AGR_ComponentTypeToVisibilityConverter.cs ---
==============================================================
using System.Globalization;
using System.Windows;
using System.Windows.Data;
using Agrovent.Infrastructure.Enums;

namespace Agrovent.Infrastructure.Converters
{
    public class AGR_ComponentTypeToVisibilityConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value is AGR_ComponentType_e componentType)
            {
                // Для purchased компонентов показываем только определенные секции
                if (componentType == AGR_ComponentType_e.Purchased)
                {
                    if (parameter.ToString().Contains("true", StringComparison.OrdinalIgnoreCase))
                    {
                        return Visibility.Visible;

                    }
                    else return Visibility.Collapsed;
                }

                // Для не-purchased показываем все
                else if (parameter.ToString().Contains("true", StringComparison.OrdinalIgnoreCase))
                {
                    return Visibility.Collapsed;
                }
            }

            return Visibility.Visible;
        }

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            throw new NotImplementedException();
        }
    }
}




--- Файл: AGR_NullToVisibilityConverter.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Data;

namespace Agrovent.Infrastructure.Converters
{
    public class AGR_NullToVisibilityConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            return value == null ? Visibility.Collapsed : Visibility.Visible;
        }

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            throw new NotImplementedException();
        }
    }
}




--- Файл: AGR_XComponentsGroupingConverter.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Data;
using Xarial.XCad.Documents;

namespace Agrovent.Infrastructure.Converters
{
    public class AGR_XComponentsGroupingConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value != null)
            {
                var group = value as IGrouping<string, IXComponent>;
                return Path.GetFileNameWithoutExtension(group.FirstOrDefault().ReferencedDocument.Path);
            }
            return null;
        }

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            throw new NotImplementedException();
        }
    }
}




--- Файл: AGR_ComponentExtension.cs ---
==============================================================
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.ViewModels.Components;
using Xarial.XCad.Data;
using Xarial.XCad.Documents;
using Xarial.XCad.SolidWorks.Documents;

namespace Agrovent.Infrastructure.Extensions
{
    public static class AGR_ComponentExtension
    {
        public static AGR_AvaType_e AvaType(this ISwDocument3D xDoc)
        {
            var prop = xDoc.Configurations.Active.Properties.GetOrPreCreate(AGR_PropertyNames.AvaType);
            if (!prop.IsCommitted) prop.Commit(CancellationToken.None);
            if (!string.IsNullOrEmpty(prop.Value.ToString()))
            {
                var avaType = Convert.ToInt32(xDoc.Configurations.Active.Properties[AGR_PropertyNames.AvaType].Value);
            if ((AGR_AvaType_e)avaType != null)
            {
                return (AGR_AvaType_e)avaType;
            }
        }
            return AGR_AvaType_e.Component;
        }
        public static AGR_ComponentType_e ComponentType(this ISwDocument3D xDoc)
        {
            var avaType = xDoc.AvaType();
            if (avaType is AGR_AvaType_e.Purchased)
            {
                return AGR_ComponentType_e.Purchased;
            }

            else
            {
                if (xDoc is ISwPart part)
                {
                    if (part.Model.GetBendState() != 0)
                    {
                        return AGR_ComponentType_e.SheetMetallPart;
                    }
                    else return AGR_ComponentType_e.Part;

                }
                else if (xDoc is ISwAssembly)
                {
                    return AGR_ComponentType_e.Assembly;
                }
            }

            return AGR_ComponentType_e.NA;
            //Assembly,
            //Part,
            //SheetMetallPart,
            //Purchased
        }

        public static IAGR_BaseComponent AGR_BaseComponent(this IXComponent xComp)
        {
            var xDoc = xComp.ReferencedDocument as ISwDocument3D;
            var componentType = xDoc.ComponentType();
            switch (componentType)
            {
                case AGR_ComponentType_e.Assembly:
                    return new AGR_AssemblyComponentVM(xDoc);
                case AGR_ComponentType_e.Part:
                case AGR_ComponentType_e.SheetMetallPart:
                case AGR_ComponentType_e.Purchased:
                    return new AGR_PartComponentVM(xDoc);
                default:
                    throw new NotImplementedException($"Component type {componentType} is not implemented.");
            }
        }
        public static IAGR_BaseComponent AGR_BaseComponent(this IXDocument xDoc)
        {
            var swDoc = xDoc as ISwDocument3D;
            var componentType = swDoc.ComponentType();
            switch (componentType)
            {
                case AGR_ComponentType_e.Assembly:
                    return new AGR_AssemblyComponentVM(swDoc);
                case AGR_ComponentType_e.Part:
                case AGR_ComponentType_e.SheetMetallPart:
                case AGR_ComponentType_e.Purchased:
                    return new AGR_PartComponentVM(swDoc);
                default:
                    throw new NotImplementedException($"Component type {componentType} is not implemented.");
            }
        }
    }
}




--- Файл: AGR_IXPropertyRepoExtension.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Xarial.XCad.Base;
using Xarial.XCad.Data;

namespace Agrovent.Infrastructure.Extensions
{
    public static class AGR_IXPropertyRepoExtension
    {
        public static IXProperty AGR_TryGetProp(this IXPropertyRepository repo, string propertyName)
        {
            IXProperty xProperty = repo.GetOrPreCreate(propertyName);
            if (!xProperty.IsCommitted) xProperty.Commit(CancellationToken.None);
            return xProperty;
        }
    }
}




--- Файл: AGR_XComponentsRepoExtension.cs ---
==============================================================
using Xarial.XCad.Documents.Enums;
using Xarial.XCad.Documents;
using Xarial.XCad.Data;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.Infrastructure.Enums;

namespace Agrovent.Infrastructure.Extensions
{
    public static class AGR_XComponentsRepoExtension
    {
        public static IEnumerable<IXComponent> AGR_TryFlatten(this IXComponentRepository repo)
        {
            IEnumerator<IXComponent> enumer;

            try
            {
                enumer = repo.GetEnumerator();
            }
            catch
            {
                yield break;
            }

            while (true)
            {
                IXComponent comp;

                try
                {
                    if (!enumer.MoveNext())
                    {
                        break;
                    }

                    comp = enumer.Current;
                }
                catch
                {
                    break;
                }

                yield return comp;

                IXComponentRepository children = null;
                AGR_AvaType_e avaType = AGR_AvaType_e.Purchased;

                var state = comp.State;

                if (!state.HasFlag(ComponentState_e.Suppressed) &&
                    !state.HasFlag(ComponentState_e.SuppressedIdMismatch) &&
                    !state.HasFlag(ComponentState_e.ExcludedFromBom) &&
                    !state.HasFlag(ComponentState_e.Embedded)
                    )
                {
                    try
                    {
                        var avaTypeProp = comp.ReferencedConfiguration.Properties.GetOrPreCreate(AGR_PropertyNames.AvaType);
                        if (avaTypeProp.IsCommitted) avaType = (AGR_AvaType_e)Convert.ToInt32(avaTypeProp.Value);
                    }
                    catch (Exception ex)
                    {

                    }
                    if (avaType != AGR_AvaType_e.Purchased &&
                        avaType != AGR_AvaType_e.DontBuy)

                    {
                        try
                        {
                            children = comp.Children;
                        }
                        catch
                        {
                            children = null;
                        }
                    }

                }
                else
                {
                    children = null;
                }

                if (children != null)
                {
                    foreach (var subComp in AGR_TryFlatten(children))
                    {
                        yield return subComp;
                    }
                }
            }
        }
        public static IEnumerable<IXComponent> AGR_ActiveComponents(this IXComponentRepository repo)
        {
            IEnumerator<IXComponent> enumer;

            try
            {
                enumer = repo.GetEnumerator();
            }
            catch
            {
                yield break;
            }

            while (true)
            {
                IXComponent comp;

                try
                {
                    if (!enumer.MoveNext())
                    {
                        break;
                    }

                    comp = enumer.Current;
                }
                catch
                {
                    break;
                }


                IXComponentRepository children;
                AGR_AvaType_e avaType = AGR_AvaType_e.Purchased;

                var state = comp.State;
                if (!state.HasFlag(ComponentState_e.Suppressed) &&
                    !state.HasFlag(ComponentState_e.SuppressedIdMismatch) &&
                    !state.HasFlag(ComponentState_e.ExcludedFromBom) &&
                    !state.HasFlag(ComponentState_e.Embedded)
                    )
                {
                    yield return comp;

                }
                else
                {
                    children = null;
                }
            }
        }
        public static IEnumerable<IAGR_BaseComponent> AGR_BaseComponents(this IXComponentRepository repo)
        {
            foreach (var xComp in repo.AGR_TryFlatten())
            {
                var agrComp = xComp.AGR_BaseComponent();
                yield return agrComp;
            }
        }
        public static IEnumerable<IAGR_BaseComponent> AGR_BaseComponents(this IEnumerable<IXComponent> repo)
        {
            foreach (var xComp in repo)
            {
                var agrComp = xComp.AGR_BaseComponent();
                yield return agrComp;
            }
        }
    }
}




--- Файл: IAGR_ComponentVersionService.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Text;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using System.Threading.Tasks;
using Agrovent.ViewModels.Components;
using Agrovent.DAL.Entities.Components;

namespace Agrovent.Infrastructure.Interfaces
{
    public interface IAGR_ComponentVersionService
    {
        Task<bool> CheckAndSaveComponentAsync(IAGR_BaseComponent component);
        Task<bool> CheckAndSaveAssemblyAsync(AGR_AssemblyComponentVM assembly);
        Task<ComponentVersion?> GetComponentVersionAsync(string partNumber, int version);
        Task<bool> HasComponentChangedAsync(IAGR_BaseComponent component);

        // Дополнительные методы (опционально)
        Task<ComponentVersion?> GetLatestComponentVersionAsync(string partNumber);
        Task<List<AssemblyStructure>> GetAssemblyStructureAsync(string assemblyPartNumber, int version);
    }
}



--- Файл: AssemblyComponentStyles.xaml ---
==============================================================
<!-- AssemblyComponentStyles.xaml -->
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:system="clr-namespace:System;assembly=mscorlib">

  

</ResourceDictionary>



--- Файл: PartComponentStyles.xaml ---
==============================================================
<!-- PartComponentStyles.xaml -->
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:Agrovent.Views.Pages">

    <!-- Общие стили для карточек -->
    <Style x:Key="CardStyle" TargetType="Border">
        <Setter Property="Background" Value="White"/>
        <Setter Property="CornerRadius" Value="8"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="BorderBrush" Value="#E0E0E0"/>
        <Setter Property="Margin" Value="0,5,0,0"/>
        <Setter Property="Padding" Value="15 5"/>
    </Style>
    
    <!-- Общие стили для карточек -->
    <Style x:Key="CardStyleExpander" TargetType="Expander">
        <Setter Property="Background" Value="White"/>
        <Setter Property="BorderBrush" Value="#E0E0E0"/>
        <Setter Property="Margin" Value="0,5,0,0"/>
        <Setter Property="Padding" Value="15 5"/>
    </Style>

    <!-- Стиль для заголовков разделов -->
    <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
        <Setter Property="FontSize" Value="13"/>
        <Setter Property="FontWeight" Value="SemiBold"/>
        <Setter Property="Foreground" Value="#1976D2"/>
    </Style>

    <!-- Стиль для групп свойств -->
    <Style x:Key="PropertyGroupStyle" TargetType="DockPanel">
        <Setter Property="Margin" Value="0,0,0,4"/>
    </Style>

    
    <!-- Стиль для меток свойств -->
    <Style x:Key="PropertyLabelStyle" TargetType="TextBlock">
        <Setter Property="Width" Value="120"/>
        <Setter Property="FontWeight" Value="Medium"/>
        <Setter Property="Foreground" Value="#616161"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>

    <!-- Стиль для заголовка таблицы свойств -->
    <Style x:Key="PropertiesDataGridHeader" TargetType="DataGridColumnHeader">
        <Setter Property="Background" Value="#c4b5fd"/>
        <Setter Property="Foreground" Value="#616161"/>
        <Setter Property="FontWeight" Value="Bold"/>
        <Setter Property="HorizontalContentAlignment" Value="Center"/>
        <Setter Property="Height" Value="25"/>
    </Style>

    <!-- Стиль для значений таблицы значений свойств -->
    <Style x:Key="PropertiesDataGrid" TargetType="DataGrid">
        <Setter Property="HeadersVisibility" Value="Column"/>
        <Setter Property="AlternatingRowBackground" Value="#d2f9e6"/>
        <Setter Property="GridLinesVisibility" Value="Horizontal"/>
        <Setter Property="HorizontalGridLinesBrush" Value="#BDBDBD"/>
        <Setter Property="AutoGenerateColumns" Value="False"/>
        <Setter Property="CanUserAddRows" Value="False"/>
        <Setter Property="CanUserDeleteRows" Value="False"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="ColumnHeaderStyle" Value="{StaticResource PropertiesDataGridHeader}"/>
    </Style>

    

    <!-- Стиль для значений свойств -->
    <Style x:Key="PropertyValueStyle" TargetType="Control">
        <Setter Property="Margin" Value="8,0,0,0"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>

        <!-- Стиль для ComboBox -->
    <Style x:Key="ModernComboBox" BasedOn="{StaticResource {x:Type ComboBox}}" TargetType="ComboBox">
        <Setter Property="Height" Value="28"/>
        <Setter Property="Padding" Value="8,4"/>
        <Setter Property="BorderBrush" Value="#BDBDBD"/>
        <Setter Property="Background" Value="White"/>
    </Style>

    <!-- Стиль для TextBox -->
    <Style x:Key="ModernTextBox" BasedOn="{StaticResource {x:Type TextBox}}" TargetType="TextBox">
        <Setter Property="Height" Value="28"/>
        <Setter Property="Padding" Value="8,4"/>
        <Setter Property="BorderBrush" Value="#BDBDBD"/>
        <Setter Property="Background" Value="White"/>
    </Style>

    <!-- Стиль для TextBlock (только чтение) -->
    <Style x:Key="ReadOnlyValueStyle" TargetType="TextBlock">
        <Setter Property="Height" Value="28"/>
        <Setter Property="Padding" Value="8,4"/>
        <Setter Property="Background" Value="#F5F5F5"/>
        <Setter Property="Foreground" Value="#212121"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>
    
    <!-- Стиль для TextBox (только чтение) -->
    <Style x:Key="ReadOnlyTextBox" BasedOn="{StaticResource ModernTextBox}" TargetType="TextBox">
        <Setter Property="BorderBrush" Value="#F5F5F5"/>
        <Setter Property="Background" Value="#F5F5F5"/>
        <Setter Property="IsReadOnly" Value="True"/>
    </Style>

    <!-- Стиль для TabControl -->
    <Style x:Key="ModernTabControl" TargetType="TabControl">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="Margin" Value="0,8,0,0"/>
    </Style>

    <!-- Стиль для TabItem -->
    <Style x:Key="ModernTabItem" TargetType="TabItem">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="TabItem">
                    <Grid>
                        <Border Name="Border" 
                              Background="#F5F5F5" 
                              BorderBrush="#E0E0E0" 
                              BorderThickness="1,1,1,0"
                              CornerRadius="4,4,0,0"
                              Margin="2,0,2,0"
                              Padding="12,8">
                            <ContentPresenter x:Name="ContentSite"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Center"
                                            ContentSource="Header"
                                            Margin="0"/>
                        </Border>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="Border" Property="Background" Value="White"/>
                            <Setter TargetName="Border" Property="BorderBrush" Value="#E0E0E0"/>
                            <Setter Property="Foreground" Value="#1976D2"/>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Border" Property="Background" Value="#F0F0F0"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Стиль для DataGrid компонентов -->
    <Style x:Key="ComponentsDataGrid" TargetType="DataGrid">
        <Setter Property="AutoGenerateColumns" Value="False"/>
        <Setter Property="CanUserAddRows" Value="False"/>
        <Setter Property="CanUserDeleteRows" Value="False"/>
        <Setter Property="IsReadOnly" Value="True"/>
        <Setter Property="SelectionMode" Value="Single"/>
        <Setter Property="SelectionUnit" Value="FullRow"/>
        <Setter Property="GridLinesVisibility" Value="None"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="RowBackground" Value="White"/>
        <Setter Property="AlternatingRowBackground" Value="#F5F5F5"/>
        <Setter Property="HeadersVisibility" Value="Column"/>
        <Setter Property="Margin" Value="0,8,0,0"/>
        <Setter Property="MaxHeight" Value="300"/>
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
        <Setter Property="ColumnHeaderStyle" Value="{StaticResource PropertiesDataGridHeader}"/>
    </Style>

    <!-- Стиль для статистических блоков -->
    <Style x:Key="StatBlockStyle" TargetType="Border">
        <Setter Property="CornerRadius" Value="4"/>
        <Setter Property="Padding" Value="8,4"/>
        <Setter Property="Margin" Value="0,0,8,8"/>
    </Style>

    <!-- Стиль для текста статистики -->
    <Style x:Key="StatLabelStyle" TargetType="TextBlock" BasedOn="{StaticResource PropertyLabelStyle}">
        <Setter Property="FontWeight" Value="SemiBold"/>
        <Setter Property="Margin" Value="0,0,4,0"/>
        <Setter Property="Width" Value="Auto"/>
    </Style>

    <!-- Стиль для счетчиков -->
    <Style x:Key="StatCounterStyle" TargetType="TextBlock">
        <Setter Property="FontSize" Value="13"/>
        <Setter Property="FontWeight" Value="Medium"/>
        <Setter Property="Foreground" Value="#212121"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>

    <!-- Цвета для разных типов компонентов -->
    <SolidColorBrush x:Key="TotalComponentsColor" Color="#E3F2FD"/>
    <SolidColorBrush x:Key="PartsColor" Color="#F3E5F5"/>
    <SolidColorBrush x:Key="AssembliesColor" Color="#E8F5E8"/>
    <SolidColorBrush x:Key="PurchasedColor" Color="#FFF3E0"/>
    <SolidColorBrush x:Key="SheetMetalColor" Color="#FCE4EC"/>

    <!-- Стиль для контейнера статистики -->
    <Style x:Key="StatsContainerStyle" TargetType="WrapPanel">
        <Setter Property="Margin" Value="0,8,0,0"/>
    </Style>

</ResourceDictionary>



--- Файл: AGR_BaseComponent.cs ---
==============================================================
using System.IO;
using Agrovent.DAL.Entities.Components;
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Interfaces.Properties;
using Agrovent.Infrastructure.Extensions;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.ViewModels.Properties;
using Xarial.XCad.SolidWorks.Data;
using Xarial.XCad.SolidWorks.Documents;
using Agrovent.Infrastructure.Interfaces;

namespace Agrovent.ViewModels.Base
{
    public class AGR_BaseComponent : BaseViewModel, IAGR_BaseComponent
    {
        internal ISwDocument3D mDocument;
        internal ISwConfiguration mConfiguration;
        internal ISwCustomPropertiesCollection mProperties;

        //public delegate void AGR_ComponentTypeChangedEventHandler(AGR_ComponentType_e type);
        //public event AGR_ComponentTypeChangedEventHandler? ComponentTypeChanged;

        public string Name { get => Path.GetFileNameWithoutExtension(mDocument.Title); }
        public string ConfigName { get => mConfiguration.Name; }
        public string PartNumber
        {
            get => mProperties.AGR_TryGetProp(AGR_PropertyNames.Partnumber).Value.ToString();
            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.Partnumber).Value = value;
        }
        public int Version
        {
            get;
            set;
            //get => Convert.ToInt32(mProperties.AGR_TryGetProp(AGR_PropertyNames.Version).Value);
            //set => mProperties.AGR_TryGetProp(AGR_PropertyNames.Partnumber).Value = value;
        }
        //public int HashSum { get => Convert.ToInt32(mProperties[AGR_PropertyNames.HashSum].Value); set => mProperties[AGR_PropertyNames.HashSum].Value = value; }
        public int HashSum
        {
            get
            {
                var value = mProperties.AGR_TryGetProp(AGR_PropertyNames.HashSum).Value;
                if (!string.IsNullOrEmpty(value.ToString()))
                {
                    return Convert.ToInt32(value);
                }
                return 0;
            }

            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.Partnumber).Value = value;
        }
        public IAGR_AvaArticleModel AvaArticle { get; set; }
        public IAGR_PropertiesCollection PropertiesCollection { get; set; }

        public AGR_ComponentType_e ComponentType
        {
            get => mDocument.ComponentType();
            set
            {
                OnPropertyChanged(nameof(ComponentType));
                //ComponentTypeChanged?.Invoke(value);
                switch (value)
                {
                    case AGR_ComponentType_e.Assembly:
                        PropertiesCollection = new AGR_BasePropertiesCollection(mDocument);
                        break;
                    case AGR_ComponentType_e.Part:
                        PropertiesCollection = new AGR_PartPropertiesCollection(mDocument);
                        break;
                    case AGR_ComponentType_e.SheetMetallPart:
                        PropertiesCollection = new AGR_SheetPartPropertiesCollection(mDocument);
                        break;
                    case AGR_ComponentType_e.Purchased:
                        PropertiesCollection?.Properties.Clear();
                        break;
                    case AGR_ComponentType_e.NA:
                        PropertiesCollection = new AGR_BasePropertiesCollection(mDocument);
                        break;
                    default:
                        break;
                }
            }
        }
        public AGR_AvaType_e AvaType
        {
            get
            {
                var val = mProperties.AGR_TryGetProp(AGR_PropertyNames.AvaType).Value;
                if (!string.IsNullOrEmpty(val.ToString()))
                {
                    return (AGR_AvaType_e)Convert.ToInt32(val);
                }
                return AGR_AvaType_e.Component;
            }

            set
            {
                mProperties.AGR_TryGetProp(AGR_PropertyNames.AvaType).Value = (int)value;

                if (value == AGR_AvaType_e.Purchased)
                {
                    ComponentType = AGR_ComponentType_e.Purchased;
                }
                else
                {
                    ComponentType = mDocument.ComponentType();
                }
            }
        }

        //private IAGR_PropertiesCollection? _PropertiesCollection;
        //public IAGR_PropertiesCollection? PropertiesCollection
        //{
        //    get => _PropertiesCollection;
        //    set => Set(ref _PropertiesCollection, value);
        //}

        public AGR_BaseComponent(ISwDocument3D swDocument3D)
        {
            mDocument = swDocument3D;
            mConfiguration = mDocument.Configurations.Active;
            mProperties = mConfiguration.Properties;

            ComponentType = mDocument.ComponentType();

        }
    }
}




--- Файл: AGR_FileComponent.cs ---
==============================================================
using System.IO;
using Agrovent.Infrastructure;
using Agrovent.Infrastructure.Interfaces.Components;
using Xarial.XCad.SolidWorks.Documents;

namespace Agrovent.ViewModels.Base
{
    public class AGR_FileComponent : AGR_BaseComponent, IAGR_HasFile
    {

        public string CurrentModelFilePath  => mDocument.Path; 
        public string CurrentDrawFilePath => GetDrawFilePath();
        public string? StorageModelFilePath  => GetStorageModelFilePath();
        public string? StorageDrawFilePath  => GetStorageDrawFilePath();
        public string? ProductionModelFilePath  => GetProdModelFilePath();
        public string? ProductionDrawFilePath  => GetProdDrawFilePath();

        private string? GetDrawFilePath()
        {
            var drawPath = Path.ChangeExtension(mDocument.Path, "slddrw");
            if (File.Exists(drawPath))
            {
                return drawPath;
            }
            else
            {
                return null;
            }
        }
        private string? GetStorageModelFilePath()
        {
            var storageModelPath = Path.Combine(
                AGR_Options.StorageRootFolderPath,
                PartNumber,
                Version.ToString(),
                Path.GetFileName(CurrentModelFilePath)
                );
            if (File.Exists(storageModelPath))
            {
                return storageModelPath;
            }
            else
            {
                return null;
            }
        }
        private string? GetStorageDrawFilePath()
        {
            var drawPath = Path.ChangeExtension(StorageModelFilePath, "slddrw");
            if (File.Exists(drawPath))
            {
                return drawPath;
            }
            else
            {
                return null;
            }
        }
        private string? GetProdModelFilePath()
        {
            var prodFilePath = Path.Combine(
                AGR_Options.ProductionRootFolderPath,
                PartNumber,
                Path.GetFileName(CurrentModelFilePath)
                );
            if (File.Exists(prodFilePath))
            {
                return prodFilePath;
            }
            else
            {
                return null;
            }
        }
        private string? GetProdDrawFilePath()
        {
            var drawPath = Path.ChangeExtension(ProductionModelFilePath, "slddrw");
            if (File.Exists(drawPath))
            {
                return drawPath;
            }
            else
            {
                return null;
            }
        }
        public AGR_FileComponent(ISwDocument3D swDocument3D) : base(swDocument3D)
        {
        }

    }
}




--- Файл: BaseViewModel.cs ---
==============================================================
using System.ComponentModel;
using System.Runtime.CompilerServices;

namespace Agrovent.ViewModels.Base
{
    public class BaseViewModel : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler PropertyChanged;

        protected virtual void OnPropertyChanged([CallerMemberName] string propertyName = null)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }

        protected virtual bool Set<T>(ref T field, T value, [CallerMemberName] string propertyName = null)
        {
            if (Equals(field, value)) return false;
            field = value;
            OnPropertyChanged(propertyName);
            return true;
        }

        protected virtual bool Set(Action action, [CallerMemberName] string propertyName = null)
        {
            action.Invoke();
            OnPropertyChanged(propertyName);
            return true;
        }


    }
    
}




--- Файл: AGR_AssemblyComponentVM.cs ---
==============================================================
using System.Collections.ObjectModel;
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Extensions;
using Agrovent.ViewModels.Base;
using Xarial.XCad.SolidWorks.Documents;
using Agrovent.ViewModels.Specification;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.Infrastructure.Interfaces.Components;
using Agrovent.Infrastructure.Interfaces.Specification;
using Agrovent.Services;
using Agrovent.Infrastructure.Interfaces;
using Agrovent.ViewModels.Properties;
using Agrovent.Infrastructure.Interfaces.Properties;

namespace Agrovent.ViewModels.Components
{
    public class AGR_AssemblyComponentVM : AGR_FileComponent, IAGR_Assembly
    {


        #region Property - 
        private IAGR_BaseComponent _SelectedItem;
        public IAGR_BaseComponent SelectedItem
        {
            get => _SelectedItem;
            set => Set(ref _SelectedItem, value);
        }
        #endregion

        #region Property - ObservableCollection<AGR_SpecificationItemVM> _AGR_TopComponents
        private ObservableCollection<AGR_SpecificationItemVM> _AGR_TopComponents;
        public ObservableCollection<AGR_SpecificationItemVM> AGR_TopComponents
        {
            get => _AGR_TopComponents;
            set => Set(ref _AGR_TopComponents, value);
        }
        #endregion

        #region Property - ObservableCollection<AGR_SpecificationItemVM> _AGR_FlatComponents
        private ObservableCollection<AGR_SpecificationItemVM> _AGR_FlatComponents;
        public ObservableCollection<AGR_SpecificationItemVM> AGR_FlatComponents
        {
            get => _AGR_FlatComponents;
            set => Set(ref _AGR_FlatComponents, value);
        }
        #endregion 
        public int TotalComponentsCount => AGR_TopComponents?.Count ?? 0;
        public int PartsCount => AGR_TopComponents?.Count(c => c.ComponentType == AGR_ComponentType_e.Part) ?? 0;
        public int AssembliesCount => AGR_TopComponents?.Count(c => c.ComponentType == AGR_ComponentType_e.Assembly) ?? 0;
        public int PurchasedCount => AGR_TopComponents?.Count(c => c.ComponentType == AGR_ComponentType_e.Purchased) ?? 0;
        public int SheetMetalPartsCount => AGR_TopComponents?.Count(c => c.ComponentType == AGR_ComponentType_e.SheetMetallPart) ?? 0;
        //public IAGR_BasePropertiesCollection PropertiesCollection { get; set; }

        public IEnumerable<IAGR_SpecificationItem> GetChildComponents()
        {
            return AGR_TopComponents;
        }
        public async Task SaveToDatabaseAsync()
        {
            var versionService = AGR_ServiceContainer.GetService<IAGR_ComponentVersionService>();
            await versionService.CheckAndSaveComponentAsync(this);
        }
        public AGR_AssemblyComponentVM(ISwDocument3D swDocument3D) : base(swDocument3D)
        {
            var assem = swDocument3D as ISwAssembly;

            // Получаем компоненты верхнего уровня
            var topComponents = assem.Configurations.Active.Components.AGR_ActiveComponents().AGR_BaseComponents();
            // Группируем и создаем SpecificationItemVM для верхнего уровня
            var groupedTop = topComponents
                .GroupBy(c => new { c.Name, c.ConfigName })
                .Select(g => new AGR_SpecificationItemVM(g.First(), g.Count()));
            AGR_TopComponents = new ObservableCollection<AGR_SpecificationItemVM>(groupedTop);

            // Получаем все компоненты (плоский список)
            var flatComponents = assem.Configurations.Active.Components.AGR_TryFlatten().AGR_BaseComponents();
            // Группируем и создаем SpecificationItemVM для плоского списка
            var groupedFlat = flatComponents
                .GroupBy(c => new { c.Name, c.ConfigName })
                .Select(g => new AGR_SpecificationItemVM(g.First(), g.Count()));
            AGR_FlatComponents = new ObservableCollection<AGR_SpecificationItemVM>(groupedFlat);

        }
    }
}




--- Файл: AGR_HomePageVM.cs ---
==============================================================
using Agrovent.Infrastructure.Interfaces.Components.Base;

namespace Agrovent.ViewModels.Components
{
    class AGR_HomePageVM : IAGR_PageView
    {

    }
}




--- Файл: AGR_Material.cs ---
==============================================================
using Agrovent.DAL.Entities.Components;
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Interfaces;
using Xarial.XCad.SolidWorks.Documents;

namespace Agrovent.ViewModels.Components
{
    public class AGR_Material : IAGR_Material
    {
        public string Name { get; set; }
        public string Article { get; set; }
        public string UOM { get; set; }
        public IAGR_AvaArticleModel AvaModel { get; set; }

        public AGR_Material(ISwDocument3D doc3D)
        {
            Name = doc3D.Configurations.Active.Properties[AGR_PropertyNames.Material].Value.ToString();
        }
    }
}




--- Файл: AGR_Paint.cs ---
==============================================================
using Agrovent.DAL.Entities.Components;
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Interfaces;
using Xarial.XCad.Data;
using Xarial.XCad.SolidWorks.Documents;

namespace Agrovent.ViewModels.Components
{
    internal class AGR_Paint : IAGR_Material
    {
        public string Name { get; set; }
        public string Article { get; set; }
        public string UOM { get; set; }
        public IAGR_AvaArticleModel AvaModel { get; set; }

        public AGR_Paint(ISwDocument3D doc3D)
        {
            var colorProp = doc3D.Configurations.Active.Properties.GetOrPreCreate(AGR_PropertyNames.Color);
            if (!colorProp.IsCommitted) colorProp.Commit(CancellationToken.None);
            Name = colorProp.Value.ToString();

        }
    }
}




--- Файл: AGR_PartComponentVM.cs ---
==============================================================
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Interfaces;
using Agrovent.Infrastructure.Interfaces.Components;
using Agrovent.Infrastructure.Interfaces.Properties;
using Agrovent.Services;
using Agrovent.ViewModels.Base;
using Agrovent.ViewModels.Properties;
using Xarial.XCad.Data;
using Xarial.XCad.SolidWorks.Documents;

namespace Agrovent.ViewModels.Components
{
    public class AGR_PartComponentVM : AGR_FileComponent, IAGR_HasMaterial, IAGR_HasPaint
    {
        public IAGR_Material BaseMaterial { get; set; }
        public decimal BaseMaterialCount { get; set; }
        public IAGR_Material? Paint { get; set; }
        public decimal? PaintCount { get; set; }
        //public IAGR_BasePropertiesCollection PropertiesCollection { get; set; }

        public async Task SaveToDatabaseAsync()
        {
            var versionService = AGR_ServiceContainer.GetService<IAGR_ComponentVersionService>();
            await versionService.CheckAndSaveComponentAsync(this);
        }
        public AGR_PartComponentVM(ISwDocument3D swDocument3D) : base(swDocument3D)
        {
            if (ComponentType == AGR_ComponentType_e.Purchased) return;
         
            BaseMaterial = new AGR_Material(swDocument3D);
            Paint = new AGR_Paint(swDocument3D);

            //switch (ComponentType)
            //{
            //    case AGR_ComponentType_e.Assembly:
            //        PropertiesCollection = new AGR_BasePropertiesCollection(mDocument);
            //        break;
            //    case AGR_ComponentType_e.Part:
            //        PropertiesCollection = new AGR_PartPropertiesCollection(mDocument);
            //        break;
            //    case AGR_ComponentType_e.SheetMetallPart:
            //        PropertiesCollection = new AGR_SheetPartPropertiesCollection(mDocument);
            //        break;
            //    case AGR_ComponentType_e.Purchased:
            //        PropertiesCollection?.Properties.Clear();
            //        break;
            //    case AGR_ComponentType_e.NA:
            //        PropertiesCollection = new AGR_BasePropertiesCollection(mDocument);
            //        break;
            //    default:
            //        break;
            //}

            //ComponentTypeChanged += AGR_PartComponentVM_ComponentTypeChanged;

        }

        private void AGR_PartComponentVM_ComponentTypeChanged(AGR_ComponentType_e type)
        {
            switch (type)
            {
                case AGR_ComponentType_e.Assembly:
                    PropertiesCollection = new AGR_BasePropertiesCollection(mDocument);
                    break;
                case AGR_ComponentType_e.Part:
                    PropertiesCollection = new AGR_PartPropertiesCollection(mDocument);
                    break;
                case AGR_ComponentType_e.SheetMetallPart:
                    PropertiesCollection = new AGR_SheetPartPropertiesCollection(mDocument);
                    break;
                case AGR_ComponentType_e.Purchased:
                    PropertiesCollection?.Properties.Clear();
                    break;
                case AGR_ComponentType_e.NA:
                    PropertiesCollection = new AGR_BasePropertiesCollection(mDocument);
                    break;
                default:
                    break;
            }

        }
    }
}




--- Файл: AGR_BasePropertiesCollection.cs ---
==============================================================
using System.Collections.ObjectModel;
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Extensions;
using Agrovent.Infrastructure.Interfaces.Properties;
using Xarial.XCad.Data;
using Xarial.XCad.SolidWorks.Data;
using Xarial.XCad.SolidWorks.Documents;

namespace Agrovent.ViewModels.Properties
{
    internal class AGR_BasePropertiesCollection : IAGR_BasePropertiesCollection
    {
        private ISwDocument3D mDocument;
        private ISwConfiguration mConfiguration;
        internal ISwCustomPropertiesCollection mProperties;

        public IXProperty Volume 
        {
            get => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankVolume); 
            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankVolume).Value = value; 
        }
        public IXProperty Mass 
        {
            get => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankMass);
            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankMass).Value = value; 
        }
        public IXProperty SurfaceArea 
        {
            get => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankArea);
            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankArea).Value = value;
        }
        public ICollection<IXProperty> Properties { get; set; }

        internal void InitProperties()
        {
            Properties = new ObservableCollection<IXProperty>();
            if (!string.IsNullOrEmpty(Volume.Value.ToString())) Properties.Add(Volume);
            if (!string.IsNullOrEmpty(Mass.Value.ToString())) Properties.Add(Mass);
            if (!string.IsNullOrEmpty(SurfaceArea.Value.ToString())) Properties.Add(SurfaceArea);
        }
        public AGR_BasePropertiesCollection(ISwDocument3D document3D)
        {
            mDocument = document3D;
            mConfiguration = mDocument.Configurations.Active;
            mProperties = mConfiguration.Properties;

            InitProperties();
        }
    }
}




--- Файл: AGR_PartPropertiesCollection.cs ---
==============================================================
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Extensions;
using Agrovent.Infrastructure.Interfaces.Properties;
using Xarial.XCad.Data;
using Xarial.XCad.SolidWorks.Documents;

namespace Agrovent.ViewModels.Properties
{
    internal class AGR_PartPropertiesCollection : AGR_BasePropertiesCollection, IAGR_PartPropertiesCollection
    {
        public IXProperty Length
        {
            get => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankLen);
            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankLen).Value = value;
        }
        public IXProperty Width
        {
            get => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankWid);
            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankWid).Value = value;
        }
        public AGR_PartPropertiesCollection(ISwDocument3D document3D) : base(document3D)
        {
            InitProperties();
            if (!string.IsNullOrEmpty(Length.Value.ToString())) Properties.Add(Length);
            if (!string.IsNullOrEmpty(Width.Value.ToString())) Properties.Add(Width);
        }
    }

}




--- Файл: AGR_SheetPartPropertiesCollection.cs ---
==============================================================
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Extensions;
using Agrovent.Infrastructure.Interfaces.Properties;
using Xarial.XCad.Data;
using Xarial.XCad.Documents;
using Xarial.XCad.SolidWorks.Documents;

namespace Agrovent.ViewModels.Properties
{
    internal class AGR_SheetPartPropertiesCollection : AGR_BasePropertiesCollection, IAGR_SheetMetallPropertiesCollection
    {
        public IXProperty SheetMetall_Length
        {
            get => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankLen);
            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankLen).Value = value;
        }
        public IXProperty SheetMetall_Width
        {
            get => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankWid);
            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankWid).Value = value;
        }
        public IXProperty SheetMetall_Thickness
        {
            get => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankThick);
            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankThick).Value = value;
        }
        public IXProperty SheetMetall_SurfaceArea
        {
            get => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankArea);
            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankArea).Value = value;
        }
        public IXProperty SheetMetall_Bends
        {
            get => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankBends);
            set => mProperties.AGR_TryGetProp(AGR_PropertyNames.BlankBends).Value = value;
        }

        //public IXProperty SheetMetall_Holes { get => mProperties[AGR_PropertyNames.BlankVolume]; set => throw new NotImplementedException(); }
        //public IXProperty SheetMetall_PlateArea { get => mProperties[AGR_PropertyNames.BlankVolume]; set => throw new NotImplementedException(); }
        //public IXProperty SheetMetall_OuterContour { get => mProperties[AGR_PropertyNames.BlankVolume]; set => throw new NotImplementedException(); }
        //public IXProperty SheetMetall_InnerContour { get => mProperties[AGR_PropertyNames.BlankVolume]; set => throw new NotImplementedException(); }
        public AGR_SheetPartPropertiesCollection(ISwDocument3D document3D) : base(document3D)
        {
            InitProperties();
            if (!string.IsNullOrEmpty(SheetMetall_Length.Value.ToString())) Properties.Add(SheetMetall_Length);
            if (!string.IsNullOrEmpty(SheetMetall_Width.Value.ToString())) Properties.Add(SheetMetall_Width);
            if (!string.IsNullOrEmpty(SheetMetall_Thickness.Value.ToString())) Properties.Add(SheetMetall_Thickness);
            if (!string.IsNullOrEmpty(SheetMetall_SurfaceArea.Value.ToString())) Properties.Add(SheetMetall_SurfaceArea);
            if (!string.IsNullOrEmpty(SheetMetall_Bends.Value.ToString())) Properties.Add(SheetMetall_Bends);
        }
    }
}




--- Файл: AGR_SpecificationItemViewModel.cs ---
==============================================================
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.Infrastructure.Interfaces.Specification;
using Agrovent.ViewModels.Base;
using Agrovent.ViewModels.Components;

namespace Agrovent.ViewModels.Specification
{
    public class AGR_SpecificationItemVM : BaseViewModel, IAGR_SpecificationItem
    {
        private readonly IAGR_BaseComponent _component;
        private readonly int _quantity;

        public IAGR_BaseComponent Component => _component;
        public string Name => _component.Name;
        public string ConfigName => _component.ConfigName;
        public string PartNumber => Component.ComponentType==AGR_ComponentType_e.Purchased ? "" : _component.PartNumber;
        public int Quantity => _quantity;

        public AGR_ComponentType_e ComponentType => _component.ComponentType;
        // Свойства для материалов (только для деталей)
        public string? MaterialName => (_component as AGR_PartComponentVM)?.BaseMaterial?.Name;
        public decimal? MaterialCount => (_component as AGR_PartComponentVM)?.BaseMaterialCount;

        // Свойства для краски
        public string? PaintName => (_component as AGR_PartComponentVM)?.Paint?.Name;
        public decimal? PaintCount => (_component as AGR_PartComponentVM)?.PaintCount;

        public AGR_SpecificationItemVM(IAGR_BaseComponent component, int quantity)
        {
            _component = component;
            _quantity = quantity;
        }
    }
}




--- Файл: AGR_SpecificationViewModel.cs ---
==============================================================
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Windows.Data;
using Agrovent.Infrastructure.Interfaces;
using Agrovent.ViewModels.Base;
using Agrovent.ViewModels.Components;

namespace Agrovent.ViewModels.Specification
{
    public class AGR_SpecificationViewModel : BaseViewModel
    {
        private AGR_AssemblyComponentVM _baseComponent;
        private CollectionViewSource _componentsCVS = new CollectionViewSource();
        public ICollectionView ComponentsView => _componentsCVS.View;

        #region Property - ObservableCollection<SpecificationItemVM> Components
        private ObservableCollection<AGR_SpecificationItemVM> _Components;
        public ObservableCollection<AGR_SpecificationItemVM> Components
        {
            get => _Components;
            set => Set(ref _Components, value);
        }
        #endregion

        #region Property - 
        private ObservableCollection<Tuple<IAGR_Material, decimal>> _Materials;
        public ObservableCollection<Tuple<IAGR_Material, decimal>> Materials
        {
            get => new(_baseComponent.AGR_FlatComponents
                        .Where(x => x.Component is AGR_PartComponentVM)
                        .GroupBy(x => (x.Component as AGR_PartComponentVM).BaseMaterial.Name)
                        .Select(x => new Tuple<IAGR_Material, decimal>
                            ((x.First().Component as AGR_PartComponentVM).BaseMaterial,
                            x.Sum(d => (d.Component as AGR_PartComponentVM).BaseMaterialCount)
                            ))
                        );
            //set => Set(ref _Materials, value);
        }
        #endregion 
        public AGR_SpecificationViewModel(AGR_AssemblyComponentVM baseComponent)
        {
            _baseComponent = baseComponent;
            Components = baseComponent.AGR_FlatComponents;
            Components.Add(new AGR_SpecificationItemVM(baseComponent,1));

            _componentsCVS.Source = Components;
        }
    }
}




--- Файл: AGR_TaskPaneViewModel.cs ---
==============================================================
using Agrovent.Services;
using Agrovent.ViewModels.Base;
using Xarial.XCad.Documents;
using Xarial.XCad.SolidWorks.Documents;
using Agrovent.ViewModels.Components;
using Xarial.XCad.Geometry;
using Agrovent.Infrastructure.Extensions;
using Xarial.XCad.SolidWorks;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.Infrastructure.Interfaces.Services;
using Microsoft.Extensions.Logging;

namespace Agrovent.ViewModels.TaskPane
{
    public class AGR_TaskPaneViewModel : BaseViewModel
    {
        private readonly ISwApplication _app;
        private readonly IAGR_ComponentViewModelFactory _viewModelFactory;
        private readonly IAGR_ComponentViewModelCache _viewModelCache;
        private readonly ILogger<AGR_TaskPaneViewModel> _logger;
        
        //123

        private CancellationTokenSource _cancellationTokenSource;

        #region Properties
        private ISwDocument3D _ActiveComponent;
        public ISwDocument3D ActiveComponent
        {
            get => _ActiveComponent;
            set => Set(ref _ActiveComponent, value);
        }

        private IAGR_PageView _ActiveView;
        public IAGR_PageView ActiveView
        {
            get => _ActiveView;
            set => Set(ref _ActiveView, value);
        }

        private IAGR_PageView _BaseComponent;
        public IAGR_PageView BaseComponent
        {
            get => _BaseComponent;
            set => Set(ref _BaseComponent, value);
        }

        private IAGR_PageView _Selection;
        public IAGR_PageView Selection
        {
            get => _Selection;
            set => Set(ref _Selection, value);
        }

        private bool _IsLoading;
        public bool IsLoading
        {
            get => _IsLoading;
            set => Set(ref _IsLoading, value);
        }

        private string _LoadingMessage;
        public string LoadingMessage
        {
            get => _LoadingMessage;
            set => Set(ref _LoadingMessage, value);
        }
        #endregion

        public AGR_TaskPaneViewModel(
            IAGR_ComponentViewModelFactory viewModelFactory,
            IAGR_ComponentViewModelCache viewModelCache,
            ILogger<AGR_TaskPaneViewModel> logger)
        {
            _app = AGR_ServiceContainer.GetService<AgroventAddin>().Application;
            _viewModelFactory = viewModelFactory;
            _viewModelCache = viewModelCache;
            _logger = logger;
            _cancellationTokenSource = new CancellationTokenSource();

            _app.Documents.DocumentActivated += OnDocumentActivatedAsync;
            _app.Idle += OnIdle;

            _logger.LogInformation("TaskPaneViewModel initialized");
        }

        private async void OnDocumentActivatedAsync(IXDocument doc)
        {
            // Отменяем предыдущую загрузку
            _cancellationTokenSource?.Cancel();
            _cancellationTokenSource = new CancellationTokenSource();
            var cancellationToken = _cancellationTokenSource.Token;

            try
            {
                _logger.LogInformation($"Document activated: {doc?.Title}");

                if (doc == null)
                {
                    ActiveView = null;
                    return;
                }

                // Показываем индикатор загрузки
                IsLoading = true;
                LoadingMessage = "Загрузка документа...";

                // Отписываемся от старых событий выделения
                if (ActiveComponent != null)
                {
                    ActiveComponent.Selections.NewSelection -= OnSelectionChangedAsync;
                    ActiveComponent.Selections.ClearSelection -= OnSelectionClearedAsync;
                }

                // Подписываемся на события выделения нового документа
                doc.Selections.NewSelection += OnSelectionChangedAsync;
                doc.Selections.ClearSelection += OnSelectionClearedAsync;

                // Асинхронно загружаем ViewModel для документа
                if (doc is ISwDocument3D swDoc)
                {
                    ActiveComponent = swDoc;

                    // Начинаем асинхронную загрузку
                    await LoadDocumentViewModelAsync(swDoc, cancellationToken);
                }
            }
            catch (OperationCanceledException)
            {
                _logger.LogDebug("Document loading cancelled");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error activating document: {doc?.Title}");
                IsLoading = false;
            }
        }

        private async Task LoadDocumentViewModelAsync(ISwDocument3D document, CancellationToken cancellationToken)
        {
            try
            {
                cancellationToken.ThrowIfCancellationRequested();

                if (document == null)
                {
                    IsLoading = false;
                    return;
                }

                _logger.LogDebug($"Loading ViewModel for: {document.Title}");

                // В зависимости от типа документа меняем сообщение
                LoadingMessage = document is ISwAssembly
                    ? "Загрузка сборки..."
                    : "Загрузка детали...";

                // Асинхронно создаем ViewModel
                var viewModel = await _viewModelFactory.CreateComponentAsync(document);

                cancellationToken.ThrowIfCancellationRequested();

                // Обновляем UI
                BaseComponent = viewModel;
                ActiveView = viewModel;

                _logger.LogInformation($"ViewModel loaded for: {document.Title}");
            }
            catch (OperationCanceledException)
            {
                _logger.LogDebug($"Loading cancelled for: {document?.Title}");
                // Не обновляем UI если загрузка отменена
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error loading ViewModel for: {document?.Title}");
                // Можно показать ошибку пользователю
            }
            finally
            {
                IsLoading = false;
                LoadingMessage = string.Empty;
            }
        }

        private async void OnSelectionChangedAsync(IXDocument doc, Xarial.XCad.IXSelObject selObject)
        {
            try
            {
                if (selObject is IXFace face && face.Component?.ReferencedDocument is ISwDocument3D swDoc)
                {
                    _logger.LogDebug($"Selection changed to: {swDoc.Title}");

                    // Асинхронно загружаем ViewModel для выбранного компонента
                    var viewModel = await _viewModelFactory.CreateComponentAsync(swDoc);

                    Selection = viewModel;
                    ActiveView = viewModel;
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error handling selection change");
            }
        }

        private void OnSelectionClearedAsync(IXDocument doc)
        {
            try
            {
                _logger.LogDebug("Selection cleared");

                if (doc is ISwDocument3D swDoc)
                {
                    // Возвращаемся к основному виду документа
                    ActiveComponent = swDoc;
                    ActiveView = BaseComponent;
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error handling selection clear");
            }
        }

        private void OnIdle(Xarial.XCad.IXApplication app)
        {
            try
            {
                // Проверяем, если документы закрыты, очищаем кэш
                if (_app.Documents.Count == 0 && ActiveComponent != null)
                {
                    _logger.LogDebug("All documents closed, cleaning up");

                    ActiveView = null;
                    BaseComponent = null;
                    ActiveComponent = null;
                    Selection = null;

                    // Можно очистить кэш если нужно
                    // _viewModelCache.Clear();
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error in idle handler");
            }
        }

        #region Команды для управления кэшем
        public void ClearViewModelCache()
        {
            try
            {
                _viewModelCache.Clear();
                _logger.LogInformation("ViewModel cache cleared by user");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error clearing view model cache");
            }
        }

        public (int Total, int Part, int Assembly) GetCacheStatistics()
        {
            return _viewModelCache.GetCacheStatistics();
        }
        #endregion

        public void Dispose()
        {
            try
            {
                _cancellationTokenSource?.Cancel();
                _cancellationTokenSource?.Dispose();

                if (_app != null)
                {
                    _app.Documents.DocumentActivated -= OnDocumentActivatedAsync;
                    _app.Idle -= OnIdle;
                }

                _logger.LogInformation("TaskPaneViewModel disposed");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error disposing TaskPaneViewModel");
            }
        }
    }

    #region MyRegion
    //private readonly ISwApplication _app = AGR_ServiceContainer.GetService<AgroventAddin>().Application;

    //#region Property - ISwAssembly ActiveComponent
    //private ISwDocument3D _ActiveComponent;
    //public ISwDocument3D ActiveComponent
    //{
    //    get => _ActiveComponent;
    //    set => Set(ref _ActiveComponent, value);
    //}
    //#endregion

    //#region Property - 
    //private IAGR_PageView? _ActiveView;
    //public IAGR_PageView? ActiveView
    //{
    //    get => _ActiveView;
    //    set => Set(ref _ActiveView, value);
    //}
    //#endregion

    //#region Property - 
    //private IAGR_PageView? _BaseComponent;
    //public IAGR_PageView? BaseComponent
    //{
    //    get => _BaseComponent;
    //    set => Set(ref _BaseComponent, value);
    //}
    //#endregion

    //#region Property - 
    //private IAGR_PageView? _Selection;
    //public IAGR_PageView? Selection
    //{
    //    get => _Selection;
    //    set => Set(ref _Selection, value);
    //}
    //#endregion 

    //#region CTOR
    //public AGR_TaskPaneViewModel()
    //{
    //    BaseComponent = new AGR_HomePageVM();
    //    _app.Documents.DocumentActivated += Documents_DocumentActivated;
    //    _app.Idle += _app_Idle;

    //}

    //private void _app_Idle(Xarial.XCad.IXApplication app)
    //{
    //    if (_app.Documents.Count == 0 && ActiveComponent != null)
    //    {
    //        ActiveView = null;
    //    }
    //}


    //#endregion

    //private void Documents_DocumentActivated(IXDocument doc)
    //{
    //    if (ActiveComponent != null)
    //    {
    //        ActiveComponent.Selections.NewSelection -= Selections_NewSelection;
    //        ActiveComponent.Selections.ClearSelection -= Selections_ClearSelection;

    //        //(ActiveComponent.Assembly as AssemblyDoc).ComponentVisibleChangeNotify -= TaskPaneVM_ComponentVisibleChangeNotify;
    //    }

    //    doc.Selections.NewSelection += Selections_NewSelection;
    //    doc.Selections.ClearSelection += Selections_ClearSelection;

    //    BaseComponent = (doc as ISwDocument3D).AGR_BaseComponent();
    //    ActiveView = BaseComponent;

    //    if (doc is ISwAssembly assembly)
    //    {
    //        ActiveComponent = assembly;
    //        //BaseComponent = new AGR_AssemblyComponentVM(assembly);
    //        return;
    //    }
    //    if (doc is ISwPart part)
    //    {
    //        ActiveComponent = part;
    //        //BaseComponent = new AGR_PartComponentVM(part);
    //        return;
    //    }
    //}

    //private void Selections_NewSelection(IXDocument doc, Xarial.XCad.IXSelObject selObject)
    //{
    //    if (selObject is IXFace face)
    //    {
    //        if (doc is ISwAssembly assembly)
    //        {
    //            if (face.Component.ReferencedDocument is ISwPart part)
    //            {
    //                Selection = new AGR_PartComponentVM(part);
    //                ActiveView = Selection;
    //                return;
    //            }
    //        }
    //        else if (doc is ISwPart part)
    //        {
    //            Selection = new AGR_PartComponentVM(part);
    //            ActiveView = Selection;
    //        }
    //    }
    //}
    //private void Selections_ClearSelection(IXDocument doc)
    //{
    //    if (doc is ISwAssembly assembly)
    //    {
    //        ActiveComponent = assembly;
    //        ActiveView = BaseComponent;
    //        return;
    //    }
    //    if (doc is ISwPart part)
    //    {
    //        ActiveComponent = part;
    //        BaseComponent = new AGR_PartComponentVM(part);
    //        return;
    //    }
    //} 
    #endregion
}





--- Файл: AGR_AssemblyPageView.xaml ---
==============================================================
<UserControl x:Class="Agrovent.Views.Pages.AGR_AssemblyPageView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vm="clr-namespace:Agrovent.ViewModels.Components"
             xmlns:local="clr-namespace:Agrovent.Views.Pages"
             xmlns:enum="clr-namespace:Agrovent.Infrastructure.Enums;assembly=Agrovent.Infrastructure"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             xmlns:converter="clr-namespace:Agrovent.Infrastructure.Converters"
             d:DataContext="{d:DesignInstance Type={x:Type vm:AGR_AssemblyComponentVM}}"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="800">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../../Resources/Styles/PartComponentStyles.xaml"/>
                <!--<ResourceDictionary Source="../../Resources/Styles/AssemblyComponentStyles.xaml"/>-->
            </ResourceDictionary.MergedDictionaries>

            <ObjectDataProvider x:Key="AvaTypeEnum" MethodName="GetValues"
                                ObjectType="{x:Type system:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="enum:AGR_AvaType_e"/>
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>

            <converter:AGR_AvaTypeConverter x:Key="AvaTypeConverter"/>

            <!-- Converter для видимости секций -->
            <converter:AGR_NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <StackPanel Margin="16" Orientation="Vertical">

            <!-- Секция: Основная информация -->
            <Expander Style="{StaticResource CardStyleExpander}" IsExpanded="True">
                <Expander.Header>
                    <TextBlock Text="Основная информация" Style="{StaticResource SectionHeaderStyle}"/>
                </Expander.Header>
                <StackPanel Orientation="Vertical">

                    <!-- Наименование -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Наименование:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding Name, Mode=OneWay}" Style="{StaticResource ReadOnlyTextBox}"/>
                    </DockPanel>

                    <!-- Тип AVA -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Тип:" Style="{StaticResource PropertyLabelStyle}"/>
                        <ComboBox ItemsSource="{Binding Source={StaticResource AvaTypeEnum}}"
                                  SelectedItem="{Binding AvaType}"
                                  Style="{StaticResource ModernComboBox}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={StaticResource AvaTypeConverter}}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </DockPanel>

                    <!-- Partnumber -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Partnumber:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding PartNumber, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource ModernTextBox}"/>
                    </DockPanel>

                    <!-- Конфигурация -->
                    <!--<DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Конфигурация:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding ConfigName, Mode=OneWay}" 
                                 Style="{StaticResource ReadOnlyTextBox}"/>
                    </DockPanel>-->

                    <!-- Версия -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Версия:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding Version, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource ReadOnlyTextBox}"/>
                    </DockPanel>
                </StackPanel>
            </Expander>

            <!-- Секция: Компоненты сборки -->
            <Expander Style="{StaticResource CardStyleExpander}" IsExpanded="True">
                <Expander.Header>
                    <TextBlock Text="Компоненты сборки" Style="{StaticResource SectionHeaderStyle}"/>
                </Expander.Header>
                <StackPanel>

                    <!-- Вкладки для разных типов компонентов -->
                    <DataGrid ItemsSource="{Binding AGR_TopComponents}" 
                                      Style="{StaticResource ComponentsDataGrid}" IsReadOnly="False">
                        <DataGrid.Columns>

                            <DataGridTemplateColumn Header="Название" Width="4*" SortMemberPath="Name">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Style="{StaticResource ReadOnlyValueStyle}" Text="{Binding Name, Mode=OneWay}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <!--<DataGridTextColumn Header="Конфигурация" 
                                                       Binding="{Binding ConfigName}" 
                                                       Width="120"/>
                                    <DataGridTextColumn Header="Тип" 
                                                       Binding="{Binding ComponentType}" 
                                                       Width="120"/>-->
                            <DataGridTemplateColumn Header="PartNumber" Width="2*" SortMemberPath="PartNumber">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBox Style="{StaticResource ReadOnlyTextBox}" Text="{Binding PartNumber, Mode=OneWay}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Кол-во" Width="*" SortMemberPath="PartNumber">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBox Style="{StaticResource ReadOnlyTextBox}" Text="{Binding Quantity, Mode=OneWay}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                    <!-- Статистика по компонентам -->
                    <!--<StackPanel Margin="0,16,0,0">
                        <TextBlock Text="Статистика:" 
                                   Style="{StaticResource SectionHeaderStyle}"
                                   FontSize="12"/>

                        <WrapPanel Style="{StaticResource StatsContainerStyle}">
                            <Border Style="{StaticResource StatBlockStyle}"
                                    Background="{StaticResource TotalComponentsColor}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Всего компонентов:" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="{Binding TotalComponentsCount}"
                                               Style="{StaticResource StatCounterStyle}"/>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource StatBlockStyle}"
                                    Background="{StaticResource PartsColor}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Деталей:" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="{Binding PartsCount}"
                                               Style="{StaticResource StatCounterStyle}"/>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource StatBlockStyle}"
                                    Background="{StaticResource AssembliesColor}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Сборок:" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="{Binding AssembliesCount}"
                                               Style="{StaticResource StatCounterStyle}"/>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource StatBlockStyle}"
                                    Background="{StaticResource PurchasedColor}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Покупных:" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="{Binding PurchasedCount}"
                                               Style="{StaticResource StatCounterStyle}"/>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource StatBlockStyle}"
                                    Background="{StaticResource SheetMetalColor}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Листовых:" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="{Binding SheetMetalPartsCount}"
                                               Style="{StaticResource StatCounterStyle}"/>
                                </StackPanel>
                            </Border>
                        </WrapPanel>
                    </StackPanel>-->
                </StackPanel>
            </Expander>

            <!-- Секция: Пользовательские свойства -->
            <Expander Style="{StaticResource CardStyleExpander}" IsExpanded="False">
                <Expander.Header>
                    <TextBlock Text="Свойства" Style="{StaticResource SectionHeaderStyle}"/>
                </Expander.Header>     
                <StackPanel>
                    <DataGrid ItemsSource="{Binding PropertiesCollection.Properties}"  
                              Style="{StaticResource PropertiesDataGrid}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Свойство" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="Значение" Binding="{Binding Value}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Expander>

            <!-- Секция: Файлы -->
            <Expander Style="{StaticResource CardStyleExpander}" IsExpanded="False">
                <Expander.Header>
                    <TextBlock Text="Файлы" Style="{StaticResource SectionHeaderStyle}"/>
                </Expander.Header>
                <StackPanel>
                    <!-- Текущий файл модели -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Модель (текущая):" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding CurrentModelFilePath, Mode=OneWay}" 
                                 Style="{StaticResource ReadOnlyTextBox}"
                                 TextWrapping="NoWrap"/>
                    </DockPanel>

                    <!-- Файл чертежа -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}" 
                              Visibility="{Binding CurrentDrawFilePath, Converter={StaticResource NullToVisibilityConverter}}">
                        <TextBlock Text="Чертеж:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding CurrentDrawFilePath, Mode=OneWay}" 
                                   Style="{StaticResource ReadOnlyTextBox}"
                                   TextWrapping="NoWrap"/>
                    </DockPanel>

                    <!-- Хранилище модели -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}" 
                              Visibility="{Binding StorageModelFilePath, Converter={StaticResource NullToVisibilityConverter}}">
                        <TextBlock Text="Модель (хранилище):" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding StorageModelFilePath, Mode=OneWay}" 
                                   Style="{StaticResource ReadOnlyTextBox}"
                                   TextWrapping="NoWrap"/>
                    </DockPanel>

                    <!-- Хранилище чертежа -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}" 
                              Visibility="{Binding StorageDrawFilePath, Converter={StaticResource NullToVisibilityConverter}}">
                        <TextBlock Text="Чертеж (хранилище):" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding StorageDrawFilePath, Mode=OneWay}" 
                                   Style="{StaticResource ReadOnlyTextBox}"
                                   TextWrapping="NoWrap"/>
                    </DockPanel>
                </StackPanel>
            </Expander>

        </StackPanel>
    </ScrollViewer>
</UserControl>



--- Файл: AGR_AssemblyPageView.xaml.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace Agrovent.Views.Pages
{
    /// <summary>
    /// Логика взаимодействия для AGR_AssemblyPageView.xaml
    /// </summary>
    public partial class AGR_AssemblyPageView : UserControl
    {
        public AGR_AssemblyPageView()
        {
            InitializeComponent();
        }
    }
}




--- Файл: AGR_EmptyPage.xaml ---
==============================================================
<UserControl x:Class="Agrovent.Views.Pages.AGR_EmptyPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Agrovent.Views.Windows"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid>
            
    </Grid>
</UserControl>




--- Файл: AGR_EmptyPage.xaml.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace Agrovent.Views.Pages
{
    /// <summary>
    /// Логика взаимодействия для AGR_EmptyPage.xaml
    /// </summary>
    public partial class AGR_EmptyPage : UserControl
    {
        public AGR_EmptyPage()
        {
            InitializeComponent();
        }
    }
}




--- Файл: AGR_PartPageView.xaml ---
==============================================================
<UserControl x:Class="Agrovent.Views.Pages.AGR_PartPageView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vm="clr-namespace:Agrovent.ViewModels.Components"
             xmlns:local="clr-namespace:Agrovent.Views.Pages"
             xmlns:enum="clr-namespace:Agrovent.Infrastructure.Enums;assembly=Agrovent.Infrastructure"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             xmlns:converter="clr-namespace:Agrovent.Infrastructure.Converters"
             d:DataContext="{d:DesignInstance Type={x:Type vm:AGR_PartComponentVM}}"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="800">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../../Resources/Styles/PartComponentStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <ObjectDataProvider x:Key="AvaTypeEnum" MethodName="GetValues"
                                ObjectType="{x:Type system:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="enum:AGR_AvaType_e"/>
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>

            <converter:AGR_AvaTypeConverter x:Key="AvaTypeConverter"/>

            <!-- Converter для видимости секций в зависимости от типа компонента -->
            <converter:AGR_ComponentTypeToVisibilityConverter x:Key="ComponentTypeToVisibilityConverter"/>
            <converter:AGR_NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <StackPanel Margin="16" Orientation="Vertical">

            <!-- Секция: Основная информация -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Orientation="Vertical">
                    <TextBlock Text="Основная информация" Style="{StaticResource SectionHeaderStyle}"/>

                    <!-- Наименование -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Наименование:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding Name, Mode=OneWay}" Style="{StaticResource ReadOnlyTextBox}"/>
                    </DockPanel>

                    <!-- Тип AVA -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Тип:" Style="{StaticResource PropertyLabelStyle}"/>
                        <ComboBox ItemsSource="{Binding Source={StaticResource AvaTypeEnum}}"
                                  SelectedItem="{Binding AvaType}"
                                  Style="{StaticResource ModernComboBox}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={StaticResource AvaTypeConverter}}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </DockPanel>

                    <!-- Partnumber -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}"
                               Visibility="{Binding ComponentType,
                               Converter={StaticResource ComponentTypeToVisibilityConverter}, ConverterParameter=False}">
                        <TextBlock Text="Partnumber:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding PartNumber, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource ModernTextBox}"/>
                    </DockPanel>
                    
                    <!-- Артикул -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}" 
                               Visibility="{Binding ComponentType,Converter={StaticResource ComponentTypeToVisibilityConverter}, ConverterParameter=True}">
                        <TextBlock Text="Артикул:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding AvaArticle.Article, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource ModernTextBox}"/>
                    </DockPanel>
                    
                    <!-- Версия -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}" 
                                Visibility="{Binding ComponentType, Converter={StaticResource ComponentTypeToVisibilityConverter}, ConverterParameter=False}">
                        <TextBlock Text="Версия:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBlock Text="{Binding Version, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource ReadOnlyValueStyle}"/>
                    </DockPanel>
                </StackPanel>
            </Border>

            <!-- Секция: Материал (только для не-purchased) -->
            <Border Style="{StaticResource CardStyle}" 
                    Visibility="{Binding ComponentType,
                        NotifyOnSourceUpdated=True,
                        NotifyOnTargetUpdated=True, Converter={StaticResource ComponentTypeToVisibilityConverter}, ConverterParameter=False}">
                <StackPanel>
                    <TextBlock Text="Материал" Style="{StaticResource SectionHeaderStyle}"/>

                    <!-- Название материала -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Материал:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding BaseMaterial.Name}" 
                                   Style="{StaticResource ReadOnlyTextBox}"/>
                    </DockPanel>

                    <!-- Количество материала -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Количество:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding BaseMaterialCount, StringFormat={}{0:F3}}"
                                   Style="{StaticResource ModernTextBox}"/>
                    </DockPanel>
                </StackPanel>
            </Border>

            <!-- Секция: Покраска (только для не-purchased) -->
            <Border Style="{StaticResource CardStyle}" 
                    Visibility="{Binding ComponentType, NotifyOnSourceUpdated=True, Converter={StaticResource ComponentTypeToVisibilityConverter}, ConverterParameter=False}">
                <StackPanel>
                    <TextBlock Text="Покраска" Style="{StaticResource SectionHeaderStyle}"/>

                    <!-- Название краски -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Краска:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBlock Text="{Binding Paint.Name}" 
                                   Style="{StaticResource ReadOnlyValueStyle}"/>
                    </DockPanel>

                    <!-- Количество краски -->
                    <!--<DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Количество:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBlock Text="{Binding PaintCount, StringFormat={}{0:F2}}"
                                   Style="{StaticResource ReadOnlyValueStyle}"/>
                    </DockPanel>-->
                </StackPanel>
            </Border>

            <!-- Секция: Пользовательские свойства (только для не-purchased) -->
            <Border Style="{StaticResource CardStyle}" 
                    Visibility="{Binding ComponentType, Converter={StaticResource ComponentTypeToVisibilityConverter}, ConverterParameter=False}">
                <StackPanel>
                    <TextBlock Text="Свойства" Style="{StaticResource SectionHeaderStyle}"/>

                    <DataGrid ItemsSource="{Binding PropertiesCollection.Properties}"  Style="{StaticResource PropertiesDataGrid}"
                              >
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Свойство" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="Значение" Binding="{Binding Value}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                    
                </StackPanel>
            </Border>

            <!-- Секция: Файлы (только для не-purchased) -->
            <Border Style="{StaticResource CardStyle}" 
                    Visibility="{Binding ComponentType, Converter={StaticResource ComponentTypeToVisibilityConverter}, ConverterParameter=False}">
                <StackPanel>
                    <TextBlock Text="Файлы" Style="{StaticResource SectionHeaderStyle}"/>

                    <!-- Текущий файл модели -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}">
                        <TextBlock Text="Модель (текущая):" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBox Text="{Binding CurrentModelFilePath, Mode=OneWay}" 
                                   Style="{StaticResource ReadOnlyTextBox}"
                                   TextWrapping="NoWrap"/>
                    </DockPanel>

                    <!-- Файл чертежа -->
                    <DockPanel Style="{StaticResource PropertyGroupStyle}" 
                                Visibility="{Binding CurrentDrawFilePath, Converter={StaticResource NullToVisibilityConverter}}">
                        <TextBlock Text="Чертеж:" Style="{StaticResource PropertyLabelStyle}"/>
                        <TextBlock Text="{Binding CurrentDrawFilePath, Mode=OneWay}" 
                                   Style="{StaticResource ReadOnlyValueStyle}"
                                   TextWrapping="NoWrap"/>
                    </DockPanel>
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</UserControl>



--- Файл: AGR_PartPageView.xaml.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace Agrovent.Views.Pages
{
    /// <summary>
    /// Логика взаимодействия для AGR_PartPageView.xaml
    /// </summary>
    public partial class AGR_PartPageView : UserControl
    {
        public AGR_PartPageView()
        {
            InitializeComponent();
        }
    }
}




--- Файл: AGR_SpecificationWindow.xaml ---
==============================================================
<Window x:Class="Agrovent.Views.Windows.AGR_SpecificationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Agrovent.Views.Windows"
        xmlns:vm="clr-namespace:Agrovent.ViewModels.Specification"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        xmlns:converter="clr-namespace:Agrovent.Infrastructure.Converters"
        xmlns:enum="clr-namespace:Agrovent.Infrastructure.Enums;assembly=Agrovent.Infrastructure"
        d:DataContext="{d:DesignInstance Type={x:Type vm:AGR_SpecificationViewModel}}"
        mc:Ignorable="d"
        Title="AGR_SpecificationWindow" Height="450" Width="800">

    <Window.Resources>
        <ResourceDictionary>
            <ObjectDataProvider x:Key="AvaTypeEnum" MethodName="GetValues"
                    ObjectType="{x:Type system:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="enum:AGR_AvaType_e"/>
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>
            <converter:AGR_AvaTypeConverter x:Key="AvaTypeConverter"/>
            <converter:AGR_ComponentTypeConverter x:Key="ComponentTypeConverter"/>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <DataGrid AutoGenerateColumns="True" EnableRowVirtualization="True" VirtualizingPanel.IsVirtualizingWhenGrouping="True"
                  CanUserAddRows="False" CanUserDeleteRows="False" GridLinesVisibility="None" HeadersVisibility="Column"
                  >
            <DataGrid.Resources>
                <CollectionViewSource x:Key="CVS_Components" Source="{Binding Components}">
                    <CollectionViewSource.GroupDescriptions>
                        <PropertyGroupDescription PropertyName="ComponentType"/>
                    </CollectionViewSource.GroupDescriptions>
                </CollectionViewSource>
            </DataGrid.Resources>

            <DataGrid.ItemsSource>
                <Binding Source="{StaticResource CVS_Components}"/>
            </DataGrid.ItemsSource>

            <DataGrid.GroupStyle>
                <GroupStyle>
                    <GroupStyle.ContainerStyle>
                        <Style TargetType="{x:Type GroupItem}">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type GroupItem}">
                                        <Expander IsExpanded="True">
                                            <Expander.Header>
                                                <DockPanel>
                                                    <TextBlock FontWeight="Bold" Text="{Binding Path=Name}" Margin="0 0 5 0"/>
                                                    <!--<TextBlock FontWeight="Bold" Text="{Binding Path=ItemCount}"/>-->
                                                </DockPanel>
                                            </Expander.Header>
                                            <Expander.Content>
                                                <ItemsPresenter />
                                            </Expander.Content>
                                        </Expander>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </GroupStyle.ContainerStyle>
                </GroupStyle>
                <GroupStyle>
                    <GroupStyle.ContainerStyle>
                        <Style TargetType="{x:Type GroupItem}">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type GroupItem}">
                                        <ItemsPresenter />
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </GroupStyle.ContainerStyle>
                </GroupStyle>

            </DataGrid.GroupStyle>
            <DataGrid.Columns>
                
                <!--<DataGridTextColumn Header="Наименование" Binding="{Binding Item1.Name}" IsReadOnly="True"/>
                
                <DataGridTemplateColumn Header="Тип">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Item1.AvaType, Converter={StaticResource AvaTypeConverter}}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.CellEditingTemplate>
                        <DataTemplate>
                            <ComboBox ItemsSource="{Binding Source={StaticResource AvaTypeEnum}}" SelectedItem="{Binding Item1.AvaType, Mode=TwoWay}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Path=., Converter={StaticResource AvaTypeConverter}}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellEditingTemplate>
                </DataGridTemplateColumn>


                <DataGridTextColumn Header="Количество" Binding="{Binding Item2}"/>-->
            </DataGrid.Columns>
        </DataGrid>



    </Grid>
</Window>




--- Файл: AGR_SpecificationWindow.xaml.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;

namespace Agrovent.Views.Windows
{
    /// <summary>
    /// Логика взаимодействия для AGR_SpecificationWindow.xaml
    /// </summary>
    public partial class AGR_SpecificationWindow : Window
    {
        public AGR_SpecificationWindow()
        {
            InitializeComponent();
        }
    }
}




--- Файл: AGR_TaskPaneView.xaml ---
==============================================================
<UserControl x:Class="Agrovent.Views.Windows.AGR_TaskPaneView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Agrovent.Views.Windows"
             xmlns:StateEnum="clr-namespace:Xarial.XCad.Documents.Enums;assembly=Xarial.XCad"
             xmlns:System="clr-namespace:System;assembly=mscorlib"
             xmlns:VM="clr-namespace:Agrovent.ViewModels.Components"
             xmlns:locator="clr-namespace:Agrovent.ViewModels"
             xmlns:page="clr-namespace:Agrovent.Views.Pages"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <ResourceDictionary>
            <ObjectDataProvider x:Key="dataFromEnum" MethodName="GetValues"
                     ObjectType="{x:Type System:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="StateEnum:ComponentState_e"/>
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>
            <locator:ViewModelLocator x:Key="VMLocator"/>

            <DataTemplate DataType="{x:Type VM:AGR_PartComponentVM}">
                <page:AGR_PartPageView/>
            </DataTemplate>
            <DataTemplate DataType="{x:Type VM:AGR_AssemblyComponentVM}">
                <page:AGR_AssemblyPageView/>
            </DataTemplate>
            <DataTemplate DataType="{x:Type VM:AGR_HomePageVM}">
                <page:AGR_EmptyPage/>
            </DataTemplate>
            
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
            
        </ResourceDictionary>
    </UserControl.Resources>

    <UserControl.DataContext>
        <Binding Path="TaskPaneVM" Source="{StaticResource VMLocator}"/>
    </UserControl.DataContext>

    <Grid>
        <Border Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"
                Background="#CCFFFFFF"
                Panel.ZIndex="1000">
            <Grid>
                <Border Background="#FFFFFFFF" 
                        BorderBrush="#FF007ACC" 
                        BorderThickness="1"
                        CornerRadius="8"
                        Width="300"
                        Height="150"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                    <StackPanel Orientation="Vertical"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Margin="20">
                        <ProgressBar IsIndeterminate="True"
                                     Height="20"
                                     Margin="0,0,0,10"/>
                        <TextBlock Text="{Binding LoadingMessage}"
                                   HorizontalAlignment="Center"
                                   FontSize="14"
                                   Foreground="#FF333333"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
        <ContentControl Content="{Binding ActiveView, UpdateSourceTrigger=PropertyChanged}"/>
    </Grid>
    
</UserControl>




--- Файл: AGR_TaskPaneView.xaml.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace Agrovent.Views.Windows
{
    /// <summary>
    /// Логика взаимодействия для TaskPaneView.xaml
    /// </summary>
    public partial class AGR_TaskPaneView : UserControl
    {
        public AGR_TaskPaneView()
        {
            InitializeComponent();
        }
    }
}




--- Файл: BaseEntity.cs ---
==============================================================
using Agrovent.DAL.Infrastructure.Interfaces;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Agrovent.DAL.Entities.Base
{
    public class BaseEntity : IAGR_BaseEntity
    {
        public int Id { get; set; }
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
        public DateTime? UpdatedAt { get; set; }
    }
}




--- Файл: AssemblyStructure.cs ---
==============================================================
using System.ComponentModel.DataAnnotations.Schema;
using Agrovent.DAL.Entities.Base;
using Agrovent.DAL.Entities.Components;

namespace Agrovent.DAL.Entities.Components
{
    public class AssemblyStructure : BaseEntity
    {
        // Сборка (родитель)
        public int AssemblyVersionId { get; set; }
        
        // Навигационное свойство для сборки
        [ForeignKey("AssemblyVersionId")]
        public ComponentVersion AssemblyVersion { get; set; }

        // Компонент в составе (ребенок)
        public int ComponentVersionId { get; set; }
        [ForeignKey("ComponentVersionId")]
        public ComponentVersion ComponentVersion { get; set; }

        // Количество
        public int Quantity { get; set; }

        // Уровень вложенности (0 - верхний уровень)
        public int Level { get; set; }

        // Родительская структура (для вложенности)
        public int? ParentStructureId { get; set; }
        [ForeignKey("ParentStructureId")]
        public AssemblyStructure? ParentStructure { get; set; }

        // Дочерние структуры
        public ICollection<AssemblyStructure> ChildStructures { get; set; } = new List<AssemblyStructure>();

        // Порядок следования (для сохранения порядка в спецификации)
        public int OrderIndex { get; set; }

        // Метод для получения полного пути
        public string GetFullPath()
        {
            var path = new List<string>();
            var current = this;

            while (current != null)
            {
                path.Insert(0, current.ComponentVersion.Name);
                current = current.ParentStructure;
            }

            return string.Join(" → ", path);
        }
    }
}



--- Файл: AvaArticleModel.cs ---
==============================================================
using Agrovent.Infrastructure.Interfaces;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Agrovent.DAL.Entities.Components
{
    public class AvaArticleModel : IAGR_AvaArticleModel
    {
        public int Article { get; set; }
        public string? PartNumber { get; set; }
        public string Name { get; set; }
        public decimal? Count { get; set; }
        public string UOM { get; set; }
        public string Type { get; set; }
        public string Folder { get; set; }
        public string Brand { get; set; }
        public string Company { get; set; }

    }
}
  



--- Файл: Component.cs ---
==============================================================
using Agrovent.DAL.Entities.Base;

namespace Agrovent.DAL.Entities.Components
{
    public class Component : BaseEntity
    {
        // Основной идентификатор (PartNumber)
        public string PartNumber { get; set; }

        // Навигационные свойства
        public ICollection<ComponentVersion> Versions { get; set; } = new List<ComponentVersion>();

        // Метод для получения последней версии
        public ComponentVersion? GetLatestVersion()
            => Versions.OrderByDescending(v => v.Version).FirstOrDefault();
    }
}



--- Файл: ComponentFile.cs ---
==============================================================
using System.ComponentModel.DataAnnotations.Schema;
using Agrovent.DAL.Entities.Base;
using Agrovent.Infrastructure.Enums;


namespace Agrovent.DAL.Entities.Components
{
    public class ComponentFile : BaseEntity
    {
        public int ComponentVersionId { get; set; }
        [ForeignKey("ComponentVersionId")]
        public ComponentVersion ComponentVersion { get; set; }

        public AGR_FileType_e FileType { get; set; }
        public string FilePath { get; set; }
        public DateTime? LastModified { get; set; }
        public long? FileSize { get; set; }
    }
}




--- Файл: ComponentMaterial.cs ---
==============================================================
using System.ComponentModel.DataAnnotations.Schema;
using Agrovent.DAL.Entities.Base;


namespace Agrovent.DAL.Entities.Components
{
    public class ComponentMaterial : BaseEntity
    {
        // Связь с версией компонента
        public int ComponentVersionId { get; set; }
        [ForeignKey("ComponentVersionId")]
        public ComponentVersion ComponentVersion { get; set; }

        // Материал
        public string? BaseMaterial { get; set; }
        public decimal BaseMaterialCount { get; set; }

        // Покраска
        public string? Paint { get; set; }
        public decimal? PaintCount { get; set; }

        // Флаг, что материал заполнен
        public bool HasMaterial => !string.IsNullOrEmpty(BaseMaterial) && BaseMaterialCount > 0;
        public bool HasPaint => !string.IsNullOrEmpty(Paint) && PaintCount.HasValue;
    }
}




--- Файл: ComponentProperty.cs ---
==============================================================
using System.ComponentModel.DataAnnotations.Schema;
using Agrovent.DAL.Entities.Base;
using Agrovent.Infrastructure.Enums;




namespace Agrovent.DAL.Entities.Components
{
    public class ComponentProperty : BaseEntity
    {
        public int ComponentVersionId { get; set; }

        [ForeignKey("ComponentVersionId")]
        public ComponentVersion ComponentVersion { get; set; }

        public string Name { get; set; }
        public string Value { get; set; }
        public AGR_PropertyType_e Type { get; set; }
    }
}




--- Файл: ComponentVersion.cs ---
==============================================================
using System.ComponentModel.DataAnnotations.Schema;
using Agrovent.DAL.Entities.Base;
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Interfaces;


namespace Agrovent.DAL.Entities.Components
{
    public class ComponentVersion : BaseEntity
    {
        // Связь с компонентом
        public int ComponentId { get; set; }
        [ForeignKey("ComponentId")]
        public Component Component { get; set; }

        // Версия (начинается с 1)
        public int Version { get; set; }

        // Уникальный хеш модели
        public int HashSum { get; set; }

        // Основные свойства
        public string Name { get; set; }
        public string ConfigName { get; set; }

        // Ссылка на статью Ava
        public AvaArticleModel? AvaArticle { get; set; }

        // Типы
        public AGR_ComponentType_e ComponentType { get; set; }
        public AGR_AvaType_e AvaType { get; set; }

        // Навигационные свойства
        public ICollection<ComponentProperty> Properties { get; set; } = new List<ComponentProperty>();
        public ComponentMaterial? Material { get; set; }
        public ICollection<ComponentFile> Files { get; set; } = new List<ComponentFile>();

        // Метод для проверки, является ли версия последней
        public bool IsLatestVersion()
        {
            if (Component == null) return false;
            return Version == Component.Versions.Max(v => v.Version);
        }
    }
}




--- Файл: IAGR_BaseEntity.cs ---
==============================================================
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Agrovent.DAL.Infrastructure.Interfaces
{
    public interface IAGR_BaseEntity
    {
        abstract int Id { get; set; }
    }
}




--- Файл: IAGR_ComponentRepository.cs ---
==============================================================
using Agrovent.DAL.Entities.Components;
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Interfaces.Components;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.Infrastructure.Interfaces.Specification;

namespace Agrovent.DAL.Repositories
{
    public interface IAGR_ComponentRepository
    {
        // Основные операции с компонентами
        Task<Component?> GetComponentByPartNumber(string partNumber);
        Task<ComponentVersion?> GetComponentVersion(string partNumber, int version);
        Task<ComponentVersion?> GetLatestComponentVersion(string partNumber);

        // Создание/обновление компонента (без транзакций - Unit of Work управляет транзакциями)
        Task<ComponentVersion> SaveComponent(IAGR_BaseComponent component, int hashSum);

        // Поиск компонента по хешу
        Task<ComponentVersion?> FindComponentByHash(int hashSum);

        // Получение структуры сборки
        Task<List<AssemblyStructure>> GetAssemblyStructure(string assemblyPartNumber, int version);
        Task SaveAssemblyStructure(IAGR_BaseComponent assembly, IEnumerable<IAGR_SpecificationItem> components);

        // Статистика
        Task<int> GetComponentCount();
        Task<int> GetComponentVersionCount();

        // Управление версиями
        Task<bool> HasComponentChanged(IAGR_BaseComponent component);
        Task<ComponentVersion?> GetExistingVersion(IAGR_BaseComponent component);
    }
}



--- Файл: ComponentRepository.cs ---
==============================================================
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using Agrovent.DAL.Entities.Components;
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Interfaces.Components;
using Agrovent.Infrastructure.Interfaces.Specification;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Agrovent.Infrastructure.Interfaces.Properties;
using Agrovent.Infrastructure.Interfaces;
using Microsoft.VisualBasic.FileIO;
using Xarial.XCad.Documents;

namespace Agrovent.DAL.Repositories
{
    public class ComponentRepository : IAGR_ComponentRepository
    {
        private readonly DataContext _context;
        private readonly ILogger<ComponentRepository> _logger;

        public ComponentRepository(DataContext context, ILogger<ComponentRepository> logger)
        {
            _context = context;
            _logger = logger;
        }

        #region Основные операции с компонентами

        public async Task<Component?> GetComponentByPartNumber(string partNumber)
        {
            try
            {
                _logger.LogDebug($"Запрос компонента по PartNumber: {partNumber}");

                return await _context.Components
                    .Include(c => c.Versions)
                        .ThenInclude(v => v.Properties)
                    .Include(c => c.Versions)
                        .ThenInclude(v => v.Material)
                    .Include(c => c.Versions)
                        .ThenInclude(v => v.Files)
                    .FirstOrDefaultAsync(c => c.PartNumber == partNumber);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при получении компонента по PartNumber: {partNumber}");
                throw;
            }
        }

        public async Task<ComponentVersion?> GetComponentVersion(string partNumber, int version)
        {
            try
            {
                _logger.LogDebug($"Запрос версии компонента: {partNumber} v{version}");

                return await _context.ComponentVersions
                    .Include(v => v.Component)
                    .Include(v => v.Properties)
                    .Include(v => v.Material)
                    .Include(v => v.Files)
                    .FirstOrDefaultAsync(v => v.Component.PartNumber == partNumber && v.Version == version);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при получении версии компонента: {partNumber} v{version}");
                throw;
            }
        }

        public async Task<ComponentVersion?> GetLatestComponentVersion(string partNumber)
        {
            try
            {
                _logger.LogDebug($"Запрос последней версии компонента: {partNumber}");

                var component = await GetComponentByPartNumber(partNumber);
                if (component == null)
                {
                    _logger.LogDebug($"Компонент не найден: {partNumber}");
                    return null;
                }

                return component.Versions
                    .OrderByDescending(v => v.Version)
                    .FirstOrDefault();
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при получении последней версии компонента: {partNumber}");
                throw;
            }
        }

        #endregion

        #region Создание/обновление компонента

        public async Task<ComponentVersion> SaveComponent(IAGR_BaseComponent component, int hashSum)
        {
            try
            {
                _logger.LogInformation($"Подготовка к сохранению компонента: {component.PartNumber}, HashSum: {hashSum}");

                // 1. Проверяем существование компонента по PartNumber
                var existingComponent = await GetComponentByPartNumber(component.PartNumber);

                if (existingComponent == null)
                {

                    // Проверяем, нет ли компонента с таким PartNumber в локальном контексте
                    var localComponent = _context.Components.Local
                        .FirstOrDefault(c => c.PartNumber == component.PartNumber);

                    if (localComponent != null)
                    {
                        _logger.LogInformation($"Компонент найден в локальном контексте: {component.PartNumber}");
                        existingComponent = localComponent;
                    }
                    else
                    {
                        _logger.LogInformation($"Создание нового компонента: {component.PartNumber}");
                        existingComponent = new Component
                        {
                            PartNumber = component.PartNumber,
                            CreatedAt = DateTime.UtcNow
                        };
                        _context.Components.Add(existingComponent);
                        // Сохраняем сразу, чтобы получить Id
                        await _context.SaveChangesAsync();
                        _logger.LogInformation($"Создан компонент с Id: {existingComponent.Id}");
                    }
                }

                // 2. Проверяем существование версии по хешу
                var existingVersion = await FindComponentByHash(hashSum);
                if (existingVersion != null)
                {
                    _logger.LogInformation($"Версия уже существует: {component.PartNumber} v{existingVersion.Version}");
                    return existingVersion;
                }

                // 3. Определяем следующую версию
                var nextVersion = existingComponent.Versions.Any()
                    ? existingComponent.Versions.Max(v => v.Version) + 1
                    : 1;

                _logger.LogInformation($"Создание новой версии: {component.PartNumber} v{nextVersion}");

                // 4. Создаем новую версию компонента
                var componentVersion = new ComponentVersion
                {
                    Component = existingComponent,
                    Version = nextVersion,
                    HashSum = hashSum,
                    Name = component.Name,
                    ConfigName = component.ConfigName,
                    AvaArticle = component.AvaArticle as AvaArticleModel,
                    ComponentType = component.ComponentType,
                    AvaType = component.AvaType,
                    CreatedAt = DateTime.UtcNow
                };

                _context.ComponentVersions.Add(componentVersion);

                // 5. Сохраняем свойства компонента
                await SaveComponentProperties(componentVersion, component);

                // 6. Сохраняем материал и покраску для деталей
                await SaveMaterialData(componentVersion, component);

                // 7. Сохраняем информацию о файлах
                await SaveFileData(componentVersion, component);

                _logger.LogInformation($"Компонент подготовлен к сохранению: {component.PartNumber} v{nextVersion}");
                return componentVersion;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при подготовке сохранения компонента: {component.PartNumber}");
                throw;
            }
        }

        #endregion

        #region Поиск компонента по хешу

        public async Task<ComponentVersion?> FindComponentByHash(int hashSum)
        {
            try
            {
                _logger.LogDebug($"Поиск компонента по хешу: {hashSum}");

                return await _context.ComponentVersions
                    .Include(v => v.Component)
                    .Include(v => v.Properties)
                    .Include(v => v.Material)
                    .Include(v => v.Files)
                    .FirstOrDefaultAsync(v => v.HashSum == hashSum);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при поиске компонента по хешу: {hashSum}");
                throw;
            }
        }

        #endregion

        #region Структура сборки

        public async Task<List<AssemblyStructure>> GetAssemblyStructure(string assemblyPartNumber, int version)
        {
            try
            {
                _logger.LogDebug($"Запрос структуры сборки: {assemblyPartNumber} v{version}");

                var assemblyVersion = await GetComponentVersion(assemblyPartNumber, version);
                if (assemblyVersion == null)
                {
                    _logger.LogWarning($"Версия сборки не найдена: {assemblyPartNumber} v{version}");
                    return new List<AssemblyStructure>();
                }

                return await _context.AssemblyStructures
                    .Include(s => s.AssemblyVersion)
                        .ThenInclude(av => av.Component)
                    .Include(s => s.ComponentVersion)
                        .ThenInclude(cv => cv.Component)
                    .Include(s => s.ComponentVersion)
                        .ThenInclude(cv => cv.Properties)
                    .Include(s => s.ComponentVersion)
                        .ThenInclude(cv => cv.Material)
                    .Where(s => s.AssemblyVersionId == assemblyVersion.Id)
                    .OrderBy(s => s.Level)
                    .ThenBy(s => s.OrderIndex)
                    .ToListAsync();
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при получении структуры сборки: {assemblyPartNumber}");
                throw;
            }
        }

        public async Task SaveAssemblyStructure(IAGR_BaseComponent assembly, IEnumerable<IAGR_SpecificationItem> components)
        {
            try
            {
                _logger.LogInformation($"Подготовка к сохранению структуры сборки: {assembly.PartNumber}");

                // 1. Сохраняем сборку как компонент
                var assemblyHash = CalculateComponentHash(assembly as IAGR_BaseComponent);
                var assemblyVersion = await SaveComponent(assembly as IAGR_BaseComponent, assemblyHash);

                // 2. Удаляем старую структуру
                //var oldStructures = await _context.AssemblyStructures
                //    .Where(s => s.AssemblyVersionId == assemblyVersion.Id)
                //    .ToListAsync();

                //if (oldStructures.Any())
                //{
                //    _context.AssemblyStructures.RemoveRange(oldStructures);
                //    _logger.LogInformation($"Удалена старая структура для сборки: {assemblyVersion.Name}");
                //}

                // 3. Сохраняем новую структуру рекурсивно
                await SaveAssemblyStructureRecursive(assemblyVersion, components.ToList(), null, 0, 0);

                _logger.LogInformation($"Структура сборки подготовлена к сохранению: {assemblyVersion.Name} v{assemblyVersion.Version}");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при подготовке сохранения структуры сборки");
                throw;
            }
        }

        private async Task SaveAssemblyStructureRecursive(
            ComponentVersion assemblyVersion,
            IList<IAGR_SpecificationItem> components,
            AssemblyStructure? parent,
            int level,
            int orderIndex)
        {
            foreach (var item in components)
            {
                // Сохраняем компонент
                var componentHash = CalculateComponentHash(item.Component);
                var componentVersion = await SaveComponent(item.Component, componentHash);

                // Создаем запись в структуре
                var structure = new AssemblyStructure
                {
                    AssemblyVersion = assemblyVersion,
                    ComponentVersion = componentVersion,
                    Quantity = item.Quantity,
                    Level = level,
                    ParentStructure = parent,
                    OrderIndex = orderIndex++
                };

                _context.AssemblyStructures.Add(structure);

                // Если компонент - сборка, рекурсивно обрабатываем его структуру
                if (item.Component is IAGR_Assembly childAssembly)
                {
                    var childComponents = childAssembly.GetChildComponents().ToList();
                    await SaveAssemblyStructureRecursive(assemblyVersion, childComponents, structure, level + 1, 0);
                }
            }
        }

        #endregion

        #region Статистика

        public async Task<int> GetComponentCount()
        {
            try
            {
                _logger.LogDebug("Запрос количества компонентов");
                return await _context.Components.CountAsync();
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Ошибка при получении количества компонентов");
                throw;
            }
        }

        public async Task<int> GetComponentVersionCount()
        {
            try
            {
                _logger.LogDebug("Запрос количества версий компонентов");
                return await _context.ComponentVersions.CountAsync();
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Ошибка при получении количества версий компонентов");
                throw;
            }
        }

        #endregion

        #region Управление версиями

        public async Task<bool> HasComponentChanged(IAGR_BaseComponent component)
        {
            try
            {
                _logger.LogDebug($"Проверка изменений компонента: {component.PartNumber}");

                var hash = CalculateComponentHash(component);
                var existingVersion = await FindComponentByHash(hash);
                return existingVersion == null;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при проверке изменений компонента: {component.PartNumber}");
                throw;
            }
        }

        public async Task<ComponentVersion?> GetExistingVersion(IAGR_BaseComponent component)
        {
            try
            {
                _logger.LogDebug($"Поиск существующей версии компонента: {component.PartNumber}");

                var hash = CalculateComponentHash(component);
                return await FindComponentByHash(hash);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Ошибка при поиске существующей версии компонента: {component.PartNumber}");
                throw;
            }
        }

        #endregion

        #region Вспомогательные методы

        private async Task SaveComponentProperties(ComponentVersion componentVersion, IAGR_BaseComponent component)
        {
            if (component.PropertiesCollection?.Properties == null || !component.PropertiesCollection.Properties.Any())
                return;

            _logger.LogDebug($"Сохранение свойств для компонента: {component.PartNumber}");

            foreach (var property in component.PropertiesCollection.Properties)
            {
                var prop = new ComponentProperty
                {
                    ComponentVersion = componentVersion,
                    Name = property.Name,
                    Value = property.Value?.ToString() ?? string.Empty,
                    Type = MapPropertyType(property.Value)
                };
                _context.ComponentProperties.Add(prop);
            }

            _logger.LogDebug($"Сохранено {component.PropertiesCollection.Properties.Count} свойств");
        }

        private async Task SaveMaterialData(ComponentVersion componentVersion, IAGR_BaseComponent component)
        {
            // Сохраняем материал только для деталей и листовых деталей
            if (component.ComponentType != AGR_ComponentType_e.Part &&
                component.ComponentType != AGR_ComponentType_e.SheetMetallPart)
                return;

            // Проверяем, реализует ли компонент интерфейсы материала и покраски
            IAGR_Material? baseMaterial = null;
            decimal baseMaterialCount = 0;
            IAGR_Material? paint = null;
            decimal? paintCount = null;

            if (component is IAGR_HasMaterial partMaterial)
            {
                baseMaterial = partMaterial.BaseMaterial;
                baseMaterialCount = partMaterial.BaseMaterialCount;
            }
            if (component is IAGR_HasPaint partPaint)
            {
                paint = partPaint.Paint;
                paintCount = partPaint.PaintCount;
            }

            _logger.LogDebug($"Сохранение материала для компонента: {component.PartNumber}");

            var material = new ComponentMaterial
            {
                ComponentVersion = componentVersion,
                BaseMaterial = baseMaterial?.Name,
                BaseMaterialCount = baseMaterialCount,
                Paint = paint?.Name,
                PaintCount = paintCount
            };

            _context.ComponentMaterials.Add(material);
        }

        private async Task SaveFileData(ComponentVersion componentVersion, IAGR_BaseComponent component)
        {
            // Проверяем, реализует ли компонент интерфейс файлов
            if (!(component is IAGR_HasFile fileComponent))
                return;

            _logger.LogDebug($"Сохранение информации о файлах для компонента: {component.PartNumber}");

            var files = new List<ComponentFile>();

            // Текущая модель
            if (!string.IsNullOrEmpty(fileComponent.CurrentModelFilePath))
            {
                files.Add(new ComponentFile
                {
                    ComponentVersion = componentVersion,
                    FileType = AGR_FileType_e.CurrentModel,
                    FilePath = fileComponent.CurrentModelFilePath,
                    LastModified = File.GetLastWriteTimeUtc(fileComponent.CurrentModelFilePath),
                    FileSize = new FileInfo(fileComponent.CurrentModelFilePath).Length
                });
            }

            // Текущий чертеж
            if (!string.IsNullOrEmpty(fileComponent.CurrentDrawFilePath))
            {
                files.Add(new ComponentFile
                {
                    ComponentVersion = componentVersion,
                    FileType = AGR_FileType_e.CurrentDrawing,
                    FilePath = fileComponent.CurrentDrawFilePath,
                    LastModified = File.GetLastWriteTimeUtc(fileComponent.CurrentDrawFilePath),
                    FileSize = new FileInfo(fileComponent.CurrentDrawFilePath).Length
                });
            }

            // Модель в хранилище
            if (!string.IsNullOrEmpty(fileComponent.StorageModelFilePath))
            {
                files.Add(new ComponentFile
                {
                    ComponentVersion = componentVersion,
                    FileType = AGR_FileType_e.StorageModel,
                    FilePath = fileComponent.StorageModelFilePath,
                    LastModified = File.GetLastWriteTimeUtc(fileComponent.StorageModelFilePath),
                    FileSize = new FileInfo(fileComponent.StorageModelFilePath).Length
                });
            }

            // Чертеж в хранилище
            if (!string.IsNullOrEmpty(fileComponent.StorageDrawFilePath))
            {
                files.Add(new ComponentFile
                {
                    ComponentVersion = componentVersion,
                    FileType = AGR_FileType_e.StorageDrawing,
                    FilePath = fileComponent.StorageDrawFilePath,
                    LastModified = File.GetLastWriteTimeUtc(fileComponent.StorageDrawFilePath),
                    FileSize = new FileInfo(fileComponent.StorageDrawFilePath).Length
                });
            }

            // Модель в производстве
            if (!string.IsNullOrEmpty(fileComponent.ProductionModelFilePath))
            {
                files.Add(new ComponentFile
                {
                    ComponentVersion = componentVersion,
                    FileType = AGR_FileType_e.ProductionModel,
                    FilePath = fileComponent.ProductionModelFilePath,
                    LastModified = File.GetLastWriteTimeUtc(fileComponent.ProductionModelFilePath),
                    FileSize = new FileInfo(fileComponent.ProductionModelFilePath).Length
                });
            }

            // Чертеж в производстве
            if (!string.IsNullOrEmpty(fileComponent.ProductionDrawFilePath))
            {
                files.Add(new ComponentFile
                {
                    ComponentVersion = componentVersion,
                    FileType = AGR_FileType_e.ProductionDrawing,
                    FilePath = fileComponent.ProductionDrawFilePath,
                    LastModified = File.GetLastWriteTimeUtc(fileComponent.ProductionDrawFilePath),
                    FileSize = new FileInfo(fileComponent.ProductionDrawFilePath).Length
                });
            }

            foreach (var file in files)
            {
                _context.ComponentFiles.Add(file);
            }

            _logger.LogDebug($"Сохранено {files.Count} файлов");
        }

        private AGR_PropertyType_e MapPropertyType(object? value)
        {
            if (value == null)
                return AGR_PropertyType_e.String;

            return value switch
            {
                bool _ => AGR_PropertyType_e.Boolean,
                sbyte or byte or short or ushort or int or uint or long or ulong => AGR_PropertyType_e.Number,
                float or double or decimal => AGR_PropertyType_e.Number,
                DateTime => AGR_PropertyType_e.Date,
                _ => AGR_PropertyType_e.String
            };
        }

        private int CalculateComponentHash(IAGR_BaseComponent component)
        {
            // Используем HashSum из компонента, если он задан
            if (component.HashSum != 0)
                return component.HashSum;

            // Иначе вычисляем хеш на основе важных свойств
            unchecked
            {
                int hash = 17;
                hash = hash * 23 + (component.Name?.GetHashCode(StringComparison.Ordinal) ?? 0);
                hash = hash * 23 + (component.ConfigName?.GetHashCode(StringComparison.Ordinal) ?? 0);
                hash = hash * 23 + (component.PartNumber?.GetHashCode(StringComparison.Ordinal) ?? 0);
                hash = hash * 23 + component.ComponentType.GetHashCode();
                hash = hash * 23 + component.AvaType.GetHashCode();
                return hash;
            }
        }

        #endregion
    }
}



--- Файл: IAGR_Assembly.cs ---
==============================================================
using System.Collections.Generic;
using Agrovent.Infrastructure.Interfaces.Properties;
using Agrovent.Infrastructure.Interfaces.Specification;

namespace Agrovent.Infrastructure.Interfaces.Components
{
    public interface IAGR_Assembly
    {
        IEnumerable<IAGR_SpecificationItem> GetChildComponents();
        //abstract IAGR_BasePropertiesCollection PropertiesCollection { get; set; }
    }
}



--- Файл: IAGR_HasFile.cs ---
==============================================================
namespace Agrovent.Infrastructure.Interfaces.Components
{

public interface IAGR_HasFile
{
    abstract string? CurrentModelFilePath { get; }
    abstract string? CurrentDrawFilePath { get; }
    abstract string? StorageModelFilePath { get; }
    abstract string? StorageDrawFilePath { get; }
    abstract string? ProductionModelFilePath { get; }
    abstract string? ProductionDrawFilePath { get; }
    }
}



--- Файл: IAGR_HasMaterial.cs ---
==============================================================
namespace Agrovent.Infrastructure.Interfaces.Components
{
    public interface IAGR_HasMaterial
    {
        abstract IAGR_Material BaseMaterial { get; set; }
        abstract decimal BaseMaterialCount { get; set; }
    }
}




--- Файл: IAGR_HasPaint.cs ---
==============================================================
namespace Agrovent.Infrastructure.Interfaces.Components
{
    public interface IAGR_HasPaint
    {
        abstract IAGR_Material? Paint { get; set; }
        abstract decimal? PaintCount { get; set; }
    }
}





--- Файл: IAGR_Material.cs ---
==============================================================

namespace Agrovent.Infrastructure.Interfaces
{
    public interface IAGR_Material
    {
        abstract string Name { get; set; }
        abstract string Article { get; set; }
        abstract string UOM { get; set; }
        abstract IAGR_AvaArticleModel AvaModel { get; set; }
    }
}



--- Файл: IAGR_Part.cs ---
==============================================================
using Agrovent.Infrastructure.Interfaces.Properties;
using System.Collections.Generic;
using Xarial.XCad.Data;

namespace Agrovent.Infrastructure.Interfaces.Components
{
    public interface IAGR_Part
    {
        abstract IAGR_Material BaseMaterial { get; set; }
        abstract decimal BaseMaterialCount { get; set; }
        abstract IAGR_Material? Paint { get; set; }
        abstract decimal? PaintCount { get; set; }
    }
}




--- Файл: IAGR_BasePropertiesCollection.cs ---
==============================================================
using Xarial.XCad.Data;

namespace Agrovent.Infrastructure.Interfaces.Properties
{
    public interface IAGR_BasePropertiesCollection : IAGR_PropertiesCollection
    {
        abstract IXProperty Volume { get; set; }
        abstract IXProperty Mass { get; set; }
        abstract IXProperty SurfaceArea { get; set; }
    }
}




--- Файл: IAGR_PartPropertiesCollection.cs ---
==============================================================
using Xarial.XCad.Data;

namespace Agrovent.Infrastructure.Interfaces.Properties
{
    public interface IAGR_PartPropertiesCollection : IAGR_PropertiesCollection
    {
        abstract IXProperty Length { get; set; }
        abstract IXProperty Width { get; set; }
    }
}




--- Файл: IAGR_PropertiesCollection.cs ---
==============================================================
using System.Collections.Generic;
using Xarial.XCad.Data;

namespace Agrovent.Infrastructure.Interfaces.Properties
{
    public interface IAGR_PropertiesCollection
    {
        abstract ICollection<IXProperty> Properties { get; set; }

    }
}




--- Файл: IAGR_SheetMetallPropertiesCollection.cs ---
==============================================================
using Xarial.XCad.Data;

namespace Agrovent.Infrastructure.Interfaces.Properties
{
    public interface IAGR_SheetMetallPropertiesCollection : IAGR_PropertiesCollection
    {
        abstract IXProperty SheetMetall_Length { get; set; }
        abstract IXProperty SheetMetall_Width { get; set; }
        abstract IXProperty SheetMetall_Thickness { get; set; }
        //abstract IXProperty SheetMetall_Holes { get; set; }
        abstract IXProperty SheetMetall_SurfaceArea { get; set; }
        //abstract IXProperty SheetMetall_PlateArea { get; set; }
        //abstract IXProperty SheetMetall_OuterContour { get; set; }
        //abstract IXProperty SheetMetall_InnerContour { get; set; }
        abstract IXProperty SheetMetall_Bends { get; set; }
    }
}




--- Файл: IAGR_ComponentViewModelCache.cs ---
==============================================================
// IAGR_ComponentViewModelCache.cs
using System.Threading.Tasks;
using Agrovent.Infrastructure.Interfaces.Components.Base;
using Xarial.XCad.Documents;

namespace Agrovent.Infrastructure.Interfaces.Services
{
    public interface IAGR_ComponentViewModelCache
    {
        /// <summary>
        /// Получить ViewModel по документу или создать новую
        /// </summary>
        Task<IAGR_BaseComponent> GetOrCreateViewModelAsync(IXDocument document);

        /// <summary>
        /// Получить ViewModel по пути к файлу
        /// </summary>
        Task<IAGR_BaseComponent> GetViewModelByPathAsync(string filePath);

        /// <summary>
        /// Очистить кэш
        /// </summary>
        void Clear();

        /// <summary>
        /// Удалить ViewModel из кэша
        /// </summary>
        bool RemoveViewModel(string key);

        /// <summary>
        /// Статистика кэша
        /// </summary>
        (int Total, int Part, int Assembly) GetCacheStatistics();
    }
}



--- Файл: IAGR_SpecificationItem.cs ---
==============================================================
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Interfaces.Components.Base;

namespace Agrovent.Infrastructure.Interfaces.Specification
{
    public interface IAGR_SpecificationItem
    {
        public string Name { get; }
        public string ConfigName { get; }
        public string PartNumber { get; }
        public int Quantity { get; }
        public IAGR_BaseComponent Component { get; }

        public AGR_ComponentType_e ComponentType { get; }

        // Свойства для материалов (только для деталей)
        public string? MaterialName { get; }
        public decimal? MaterialCount { get; }

        // Свойства для краски
        public string? PaintName { get; }
        public decimal? PaintCount { get; }

    }
}



--- Файл: BaseCommand.cs ---
==============================================================
using System.Windows;
using System.Windows.Input;

namespace Agrovent.Infrastructure.Commands.Base
{
    public abstract class BaseCommand : ICommand
    {
        public event EventHandler? CanExecuteChanged
        {
            add => CommandManager.RequerySuggested += value;
            remove => CommandManager.RequerySuggested -= value;
        }

        public abstract bool CanExecute(object? parameter);

        public abstract void Execute(object? parameter);
    }
}




--- Файл: .NETCoreApp,Version=v6.0.AssemblyAttributes.cs ---
==============================================================
// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETCoreApp,Version=v6.0", FrameworkDisplayName = ".NET 6.0")]




--- Файл: Agrovent.AssemblyInfo.cs ---
==============================================================
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("Agrovent")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0")]
[assembly: System.Reflection.AssemblyProductAttribute("Agrovent")]
[assembly: System.Reflection.AssemblyTitleAttribute("Agrovent")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]
[assembly: System.Runtime.Versioning.TargetPlatformAttribute("Windows7.0")]
[assembly: System.Runtime.Versioning.SupportedOSPlatformAttribute("Windows7.0")]

// Создано классом WriteCodeFragment MSBuild.





--- Файл: Agrovent.GlobalUsings.g.cs ---
==============================================================
// <auto-generated/>
global using global::System;
global using global::System.Collections.Generic;
global using global::System.Linq;
global using global::System.Threading;
global using global::System.Threading.Tasks;




--- Файл: Agrovent_z5vh1jeq_wpftmp.AssemblyInfo.cs ---
==============================================================
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("Agrovent")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0")]
[assembly: System.Reflection.AssemblyProductAttribute("Agrovent")]
[assembly: System.Reflection.AssemblyTitleAttribute("Agrovent")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]
[assembly: System.Runtime.Versioning.TargetPlatformAttribute("Windows7.0")]
[assembly: System.Runtime.Versioning.SupportedOSPlatformAttribute("Windows7.0")]

// Создано классом WriteCodeFragment MSBuild.





--- Файл: Agrovent_z5vh1jeq_wpftmp.GlobalUsings.g.cs ---
==============================================================
// <auto-generated/>
global using global::System;
global using global::System.Collections.Generic;
global using global::System.Linq;
global using global::System.Threading;
global using global::System.Threading.Tasks;




--- Файл: GeneratedInternalTypeHelper.g.cs ---
==============================================================
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

namespace XamlGeneratedNamespace {
    
    
    /// <summary>
    /// GeneratedInternalTypeHelper
    /// </summary>
    [System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
    [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
    public sealed class GeneratedInternalTypeHelper : System.Windows.Markup.InternalTypeHelper {
        
        /// <summary>
        /// CreateInstance
        /// </summary>
        protected override object CreateInstance(System.Type type, System.Globalization.CultureInfo culture) {
            return System.Activator.CreateInstance(type, ((System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.NonPublic) 
                            | (System.Reflection.BindingFlags.Instance | System.Reflection.BindingFlags.CreateInstance)), null, null, culture);
        }
        
        /// <summary>
        /// GetPropertyValue
        /// </summary>
        protected override object GetPropertyValue(System.Reflection.PropertyInfo propertyInfo, object target, System.Globalization.CultureInfo culture) {
            return propertyInfo.GetValue(target, System.Reflection.BindingFlags.Default, null, null, culture);
        }
        
        /// <summary>
        /// SetPropertyValue
        /// </summary>
        protected override void SetPropertyValue(System.Reflection.PropertyInfo propertyInfo, object target, object value, System.Globalization.CultureInfo culture) {
            propertyInfo.SetValue(target, value, System.Reflection.BindingFlags.Default, null, null, culture);
        }
        
        /// <summary>
        /// CreateDelegate
        /// </summary>
        protected override System.Delegate CreateDelegate(System.Type delegateType, object target, string handler) {
            return ((System.Delegate)(target.GetType().InvokeMember("_CreateDelegate", (System.Reflection.BindingFlags.InvokeMethod 
                            | (System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)), null, target, new object[] {
                        delegateType,
                        handler}, null)));
        }
        
        /// <summary>
        /// AddEventHandler
        /// </summary>
        protected override void AddEventHandler(System.Reflection.EventInfo eventInfo, object target, System.Delegate handler) {
            eventInfo.AddEventHandler(target, handler);
        }
    }
}





--- Файл: GeneratedInternalTypeHelper.g.i.cs ---
==============================================================
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

namespace XamlGeneratedNamespace {
    
    
    /// <summary>
    /// GeneratedInternalTypeHelper
    /// </summary>
    [System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
    [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
    public sealed class GeneratedInternalTypeHelper : System.Windows.Markup.InternalTypeHelper {
        
        /// <summary>
        /// CreateInstance
        /// </summary>
        protected override object CreateInstance(System.Type type, System.Globalization.CultureInfo culture) {
            return System.Activator.CreateInstance(type, ((System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.NonPublic) 
                            | (System.Reflection.BindingFlags.Instance | System.Reflection.BindingFlags.CreateInstance)), null, null, culture);
        }
        
        /// <summary>
        /// GetPropertyValue
        /// </summary>
        protected override object GetPropertyValue(System.Reflection.PropertyInfo propertyInfo, object target, System.Globalization.CultureInfo culture) {
            return propertyInfo.GetValue(target, System.Reflection.BindingFlags.Default, null, null, culture);
        }
        
        /// <summary>
        /// SetPropertyValue
        /// </summary>
        protected override void SetPropertyValue(System.Reflection.PropertyInfo propertyInfo, object target, object value, System.Globalization.CultureInfo culture) {
            propertyInfo.SetValue(target, value, System.Reflection.BindingFlags.Default, null, null, culture);
        }
        
        /// <summary>
        /// CreateDelegate
        /// </summary>
        protected override System.Delegate CreateDelegate(System.Type delegateType, object target, string handler) {
            return ((System.Delegate)(target.GetType().InvokeMember("_CreateDelegate", (System.Reflection.BindingFlags.InvokeMethod 
                            | (System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)), null, target, new object[] {
                        delegateType,
                        handler}, null)));
        }
        
        /// <summary>
        /// AddEventHandler
        /// </summary>
        protected override void AddEventHandler(System.Reflection.EventInfo eventInfo, object target, System.Delegate handler) {
            eventInfo.AddEventHandler(target, handler);
        }
    }
}





--- Файл: .NETCoreApp,Version=v6.0.AssemblyAttributes.cs ---
==============================================================
// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETCoreApp,Version=v6.0", FrameworkDisplayName = ".NET 6.0")]




--- Файл: Agrovent.DAL.AssemblyInfo.cs ---
==============================================================
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("Agrovent.DAL")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0")]
[assembly: System.Reflection.AssemblyProductAttribute("Agrovent.DAL")]
[assembly: System.Reflection.AssemblyTitleAttribute("Agrovent.DAL")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// Создано классом WriteCodeFragment MSBuild.





--- Файл: Agrovent.DAL.GlobalUsings.g.cs ---
==============================================================
// <auto-generated/>
global using global::System;
global using global::System.Collections.Generic;
global using global::System.IO;
global using global::System.Linq;
global using global::System.Net.Http;
global using global::System.Threading;
global using global::System.Threading.Tasks;




--- Файл: IAGR_BaseComponent.cs ---
==============================================================
using Agrovent.Infrastructure.Enums;
using Agrovent.Infrastructure.Interfaces.Properties;

namespace Agrovent.Infrastructure.Interfaces.Components.Base
{
    public interface IAGR_BaseComponent : IAGR_BaseObject, IAGR_PageView
    {
        abstract string Name { get; }
        abstract string ConfigName { get; }
        abstract string PartNumber { get; set; }
        abstract int Version { get; set; }
        abstract int HashSum { get; set; }
        abstract IAGR_AvaArticleModel AvaArticle { get; set; }
        abstract AGR_ComponentType_e ComponentType { get; set; }
        abstract AGR_AvaType_e AvaType { get; set; }
        abstract IAGR_PropertiesCollection PropertiesCollection { get; set; }

    }
}




--- Файл: IAGR_BaseObject.cs ---
==============================================================
namespace Agrovent.Infrastructure.Interfaces.Components.Base
{
    public interface IAGR_BaseObject
    {
    }
}




--- Файл: IAGR_PageView.cs ---
==============================================================
namespace Agrovent.Infrastructure.Interfaces.Components.Base
{
    public interface IAGR_PageView
    {
    }
}



--- Файл: .NETStandard,Version=v2.1.AssemblyAttributes.cs ---
==============================================================
// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETStandard,Version=v2.1", FrameworkDisplayName = ".NET Standard 2.1")]




--- Файл: Agrovent.Infrastructure.AssemblyInfo.cs ---
==============================================================
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("Agrovent.Infrastructure")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0")]
[assembly: System.Reflection.AssemblyProductAttribute("Agrovent.Infrastructure")]
[assembly: System.Reflection.AssemblyTitleAttribute("Agrovent.Infrastructure")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// Создано классом WriteCodeFragment MSBuild.





--- Файл: AGR_AssemblyPageView.g.cs ---
==============================================================
#pragma checksum "..\..\..\..\..\Views\Pages\AGR_AssemblyPageView.xaml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "FE23443B8F3FEF59C941B149F2A6D410DF24D673"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using Agrovent.Infrastructure.Converters;
using Agrovent.Infrastructure.Enums;
using Agrovent.ViewModels.Components;
using Agrovent.Views.Pages;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Controls.Ribbon;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Agrovent.Views.Pages {
    
    
    /// <summary>
    /// AGR_AssemblyPageView
    /// </summary>
    public partial class AGR_AssemblyPageView : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Agrovent;component/views/pages/agr_assemblypageview.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\..\..\Views\Pages\AGR_AssemblyPageView.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}





--- Файл: AGR_AssemblyPageView.g.i.cs ---
==============================================================
#pragma checksum "..\..\..\..\..\Views\Pages\AGR_AssemblyPageView.xaml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "FE23443B8F3FEF59C941B149F2A6D410DF24D673"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using Agrovent.Infrastructure.Converters;
using Agrovent.Infrastructure.Enums;
using Agrovent.ViewModels.Components;
using Agrovent.Views.Pages;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Controls.Ribbon;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Agrovent.Views.Pages {
    
    
    /// <summary>
    /// AGR_AssemblyPageView
    /// </summary>
    public partial class AGR_AssemblyPageView : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Agrovent;V1.0.0.0;component/views/pages/agr_assemblypageview.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\..\..\Views\Pages\AGR_AssemblyPageView.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}





--- Файл: AGR_EmptyPage.g.cs ---
==============================================================
#pragma checksum "..\..\..\..\..\Views\Pages\AGR_EmptyPage.xaml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "7C0294A781C9CBFA89B805315EEE01099A3D91DC"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using Agrovent.Views.Windows;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Controls.Ribbon;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Agrovent.Views.Pages {
    
    
    /// <summary>
    /// AGR_EmptyPage
    /// </summary>
    public partial class AGR_EmptyPage : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Agrovent;component/views/pages/agr_emptypage.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\..\..\Views\Pages\AGR_EmptyPage.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}





--- Файл: AGR_EmptyPage.g.i.cs ---
==============================================================
#pragma checksum "..\..\..\..\..\Views\Pages\AGR_EmptyPage.xaml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "7C0294A781C9CBFA89B805315EEE01099A3D91DC"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using Agrovent.Views.Windows;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Controls.Ribbon;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Agrovent.Views.Pages {
    
    
    /// <summary>
    /// AGR_EmptyPage
    /// </summary>
    public partial class AGR_EmptyPage : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Agrovent;V1.0.0.0;component/views/pages/agr_emptypage.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\..\..\Views\Pages\AGR_EmptyPage.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}





--- Файл: AGR_PartPageView.g.cs ---
==============================================================
#pragma checksum "..\..\..\..\..\Views\Pages\AGR_PartPageView.xaml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "926FB282A9C61EB13A13F6FEBABEBA4809C60731"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using Agrovent.Infrastructure.Converters;
using Agrovent.Infrastructure.Enums;
using Agrovent.ViewModels.Components;
using Agrovent.Views.Pages;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Controls.Ribbon;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Agrovent.Views.Pages {
    
    
    /// <summary>
    /// AGR_PartPageView
    /// </summary>
    public partial class AGR_PartPageView : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Agrovent;component/views/pages/agr_partpageview.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\..\..\Views\Pages\AGR_PartPageView.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}





--- Файл: AGR_PartPageView.g.i.cs ---
==============================================================
#pragma checksum "..\..\..\..\..\Views\Pages\AGR_PartPageView.xaml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "926FB282A9C61EB13A13F6FEBABEBA4809C60731"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using Agrovent.Infrastructure.Converters;
using Agrovent.Infrastructure.Enums;
using Agrovent.ViewModels.Components;
using Agrovent.Views.Pages;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Controls.Ribbon;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Agrovent.Views.Pages {
    
    
    /// <summary>
    /// AGR_PartPageView
    /// </summary>
    public partial class AGR_PartPageView : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Agrovent;V1.0.0.0;component/views/pages/agr_partpageview.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\..\..\Views\Pages\AGR_PartPageView.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}





--- Файл: AGR_SpecificationWindow.g.cs ---
==============================================================
#pragma checksum "..\..\..\..\..\Views\Windows\AGR_SpecificationWindow.xaml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "816223AA5DA9D30562D56CD8A8D59F5BD1E8F182"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using Agrovent.Infrastructure.Converters;
using Agrovent.Infrastructure.Enums;
using Agrovent.ViewModels.Specification;
using Agrovent.Views.Windows;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Controls.Ribbon;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Agrovent.Views.Windows {
    
    
    /// <summary>
    /// AGR_SpecificationWindow
    /// </summary>
    public partial class AGR_SpecificationWindow : System.Windows.Window, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Agrovent;component/views/windows/agr_specificationwindow.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\..\..\Views\Windows\AGR_SpecificationWindow.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}





--- Файл: AGR_SpecificationWindow.g.i.cs ---
==============================================================
#pragma checksum "..\..\..\..\..\Views\Windows\AGR_SpecificationWindow.xaml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "816223AA5DA9D30562D56CD8A8D59F5BD1E8F182"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using Agrovent.Infrastructure.Converters;
using Agrovent.Infrastructure.Enums;
using Agrovent.ViewModels.Specification;
using Agrovent.Views.Windows;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Controls.Ribbon;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Agrovent.Views.Windows {
    
    
    /// <summary>
    /// AGR_SpecificationWindow
    /// </summary>
    public partial class AGR_SpecificationWindow : System.Windows.Window, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Agrovent;V1.0.0.0;component/views/windows/agr_specificationwindow.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\..\..\Views\Windows\AGR_SpecificationWindow.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}





--- Файл: AGR_TaskPaneView.g.cs ---
==============================================================
#pragma checksum "..\..\..\..\..\Views\Windows\AGR_TaskPaneView.xaml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "623C6ADEAD321895D3B4E75B5485708430D195CD"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using Agrovent.ViewModels;
using Agrovent.ViewModels.Components;
using Agrovent.Views.Pages;
using Agrovent.Views.Windows;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Controls.Ribbon;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;
using Xarial.XCad.Documents.Enums;


namespace Agrovent.Views.Windows {
    
    
    /// <summary>
    /// AGR_TaskPaneView
    /// </summary>
    public partial class AGR_TaskPaneView : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Agrovent;component/views/windows/agr_taskpaneview.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\..\..\Views\Windows\AGR_TaskPaneView.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}





--- Файл: AGR_TaskPaneView.g.i.cs ---
==============================================================
#pragma checksum "..\..\..\..\..\Views\Windows\AGR_TaskPaneView.xaml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "623C6ADEAD321895D3B4E75B5485708430D195CD"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using Agrovent.ViewModels;
using Agrovent.ViewModels.Components;
using Agrovent.Views.Pages;
using Agrovent.Views.Windows;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Controls.Ribbon;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;
using Xarial.XCad.Documents.Enums;


namespace Agrovent.Views.Windows {
    
    
    /// <summary>
    /// AGR_TaskPaneView
    /// </summary>
    public partial class AGR_TaskPaneView : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Agrovent;V1.0.0.0;component/views/windows/agr_taskpaneview.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\..\..\Views\Windows\AGR_TaskPaneView.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "9.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}




==============================================================
--- Конец проекта ---
